# Экзамен по сетям

---

## Оглавление

- [IP пакет, структура IP пакета](#ip-пакет-структура-ip-пакета)
- [IP маршрутизация, упрощённая таблица маршрутизации, таблица маршрутизации конечного хоста](#ip-маршрутизация-упрощённая-таблица-маршрутизации-таблица-маршрутизации-конечного-хоста)
- [IP маршрутизация: без масок, на основе масок](#ip-маршрутизация-без-масок-на-основе-масок)
- [Схема протоколов модели OSI](#схема-протоколов-модели-osi)
- [Протокол ICMP, структура кадра, типы сообщений, коды ошибок](#протокол-icmp-структура-кадра-типы-сообщений-коды-ошибок)
- [Протоколы TCP/UDP мультиплексировени и демультиплексирование, сокеты](#протоколы-tcpudp-мультиплексировени-и-демультиплексирование-сокеты)
- [Протокол UDP, структура кадра](#протокол-udp-структура-кадра)
- [Протокол TCP, структура кадра, схема логического содеинения в TCP](#протокол-tcp-структура-кадра-схема-логического-содеинения-в-tcp)
- [Протокол TCP, схма состояний](#протокол-tcp-схма-состояний)
- [Классификация протоколов маршрутизации](#классификация-протоколов-маршрутизации)
- [Протокол RIP, время жизни пакетов, зацикливание пакетов](#протокол-rip-время-жизни-пакетов-зацикливание-пакетов)
- [Протокол BGP](#протокол-bgp)
- [Общие принципы построения служб](#общие-принципы-построения-служб)
- [URI, URL, URN](#uri-url-urn)
- [Протокол HTTP, веб-клиент, веб-сервер, заголовки, cookie](#протокол-http-веб-клиент-веб-сервер-заголовки-cookie)
- [Протоколы TLS, SSL](#протоколы-tls-ssl)
- [Протокол FTP](#протокол-ftp)
- [Почтовая служба, протоколы POP и IMAP](#почтовая-служба-протоколы-pop-и-imap)
- [Протокол DNS](#протокол-dns)
- [Протоколы IPv5 и IPv6. Стркуктрура даресов IPv6](#протоколы-ipv5-и-ipv6-стркуктрура-даресов-ipv6)
- [Формат пакета IPv6](#формат-пакета-ipv6)
- [Архитектура безпроводных сетей](#архитектура-безпроводных-сетей)
- [Стек протоколов и стандарты IEEE 802.11](#стек-протоколов-и-стандарты-ieee-80211)
- [Формат кадра в стандарте IEEE 802.11](#формат-кадра-в-стандарте-ieee-80211)
- [Процедура присоединения устройств в IEEE 802.11](#процедура-присоединения-устройств-в-ieee-80211)
- [Работа proxy и NAT](#работа-proxy-и-nat)
- [Фаервол, основные функции, классификация](#фаервол-основные-функции-классификация)
- [Фаервол - схема настройки и фильтрации пакетов](#фаервол---схема-настройки-и-фильтрации-пакетов)
- [Определение и принципы работы WAF, NGFW, UTM](#определение-и-принципы-работы-waf-ngfw-utm)
- [Структура правила snort](#структура-правила-snort)
- [Атака TCP syn flood](#атака-tcp-syn-flood)
- [Атака TCP syn-ACK flood](#атака-tcp-syn-`ACK`-flood)
- [Атаки TCP rst\FIN flood](#атаки-tcp-rst`FIN`-flood)
- [Атака фраментированный ICMP\UDP flood, атака Ping Of Death](#атака-фраментированный-icmpudp-flood-атака-ping-of-death)
- [Атака ARP-spooFINg](#атака-arp-spoo`FIN`g)

---

## IP пакет, структура IP пакета

Протокол IP относится к протоколам _без установления соединений_, поддерживая обработку
каждого IP-пакета как независимой единицы обмена, не связанной с другими пакетами.
В протоколе IP нет механизмов, обычно применяемых для обеспечения достоверности
конечных данных. Если во время продвижения пакета происходит какая-либо ошибка, то
протокол IP по своей инициативе ничего не предпринимает для ее исправления. Протокол IP реализует политику доставки «по
возможности».

### Структура IP пакета:

* `Номер версии` занимает 4 бита и идентифицирует версию протокола IP. (IPv4, IPv6)
* `Длина заголовка` занимает 4 бита и и измеряется в 32-битных
  словах. Обычно заголовок имеет длину в 20 байт (пять 32-битных слов), но при добавлении некоторой служебной информации
  это значение может быть увеличено за счет дополнительных байтов в поле параметров. Наибольшая длина заголовка
  составляет 60 байт.
* `Тип сервиса (Type of Service, ToS)` имеет и другое, более современное название —
  `байт дифференцированного обслуживания`, или` DS-байт`. Поле служит для хранения признаков, отражающих требования к
  качеству обслуживания пакета.
    * В прежнем варианте первые три бита содержат значение приоритета пакета: от самого
      низкого — 0 до самого высокого — 7. Маршрутизаторы и компьютеры могут принимать
      во внимание приоритет пакета и обрабатывать более важные пакеты в первую очередь.
    * Следующие три бита поля `ToS` определяют критерий выбора маршрута. Если для бита `D
      (Delay — задержка)` установлено значение 1, то маршрут должен выбираться для минимизации задержки доставки данного
      пакета.
    * Установленный бит `T (Throughput — пропускная
      способность)` — для максимизации пропускной способности
    * Бит `R (Reliability — надежность)` — для максимизации
      надежности доставки. Оставшиеся два бита имеют нулевое
      значение.

    * Стандарты дифференцированного обслуживания, принятые в конце 90-х, дали новое название этому полю, переопределив
      назначение его битов. В `DS-байте` также используются только старшие 6 бит, а два младших бита резервируются.
      `Об этом лучше не упоминать, тк вопроса про DS байты нет в экзамене`
* `Общая длина (2 байта)` - характеризует общую длину пакета с учетом заголовка и поля данных. Максимальная длина пакета
  ограничена разрядностью поля, определяющего эту величину, и составляет 65 535 байт, но в большинстве компьютеров и
  сетей столь большие пакеты не используются. _При передаче по сетям различного типа
  длина пакета выбирается с учетом максимальной длины пакета протокола нижнего уровня, несущего IP-пакеты._ `В стандартах TCP/IP
  предусматривается, что все хосты должны быть готовы принимать пакеты длиной вплоть
  до 576 байт (независимо от того, приходят они целиком или фрагментами).`
* `Идентификатор пакета (2 байта)` - используется для распознавания пакетов,
  образовавшихся путем деления на части (фрагментации) исходного пакета. Все части
  (фрагменты) одного пакета должны иметь одинаковое значение этого поля.
* `Флаги (3 байта)` - содержат признаки, связанные с фрагментацией.
    * `бит DF (Do not Fragment — не фрагментировать)` запрещает маршрутизатору
      фрагментировать данный пакет,
    * `бит MF (More Fragments — больше фрагментов)` говорит о том, что данный пакет является промежуточным (не
      последним)
      фрагментом.
    * Оставшийся бит зарезервирован.
* `Смещения фрагмента (13 бит)` задает смещение в байтах поля данных этого
  фрагмента относительно начала поля данных исходного (нефрагментированного) пакета. `Используется при сборке/разборке
  фрагментов пакетов. Смещение должно быть кратно 8 байтам.`
* `Время жизни (1 байт)` используется для задания
  предельного срока, в течение которого пакет может перемещаться по сети. Время жизни
  пакета измеряется в секундах и задается источником. Поскольку современные
  маршрутизаторы редко обрабатывают пакет дольше, чем за одну секунду, то время жизни
  можно интерпретировать как `максимальное число транзитных узлов`, которые разрешено
  пройти пакету. Если значение поля времени жизни становится нулевым до того, как пакет
  достигает получателя, то пакет уничтожается. `Таким образом, время жизни является своего
  рода часовым механизмом самоуничтожения пакета.`
* `Протокол верхнего уровная(1 байт)` одержит идентификатор, указывающий, какому протоколу верхнего уровня принадлежит
  информация, размещенная
  в поле данных пакета. Например, 6 означает, что
  в пакете находится сообщение протокола TCP, 17 — протокола UDP, 1 — протокола ICMP.

| **Значение** | **Протокол**                                       | **Описание**                                     |
  |--------------|----------------------------------------------------|--------------------------------------------------|
| 0            | Зарезервировано                                    | Используется для специальных целей.              |
| 1            | ICMP (Internet Control Message Protocol)           | Протокол управления сообщениями.                 |
| 2            | IGMP (Internet Group Management Protocol)          | Протокол управления группами.                    |
| 3            | GGP (Gateway-to-Gateway Protocol)                  | Протокол маршрутизации между шлюзами.            |
| 4            | IPv4 (encapsulation)                               | Инкапсуляция IPv4 в IPv4.                        |
| 5            | ST (Stream Protocol)                               | Протокол потоковой передачи.                     |
| 6            | TCP (Transmission Control Protocol)                | Надежный протокол передачи данных.               |
| 8            | EGP (Exterior Gateway Protocol)                    | Протокол внешнего шлюза.                         |
| 9            | IGP (Interior Gateway Protocol)                    | Протокол внутреннего шлюза.                      |
| 17           | UDP (User Datagram Protocol)                       | Ненадежный протокол передачи данных.             |
| 27           | RDP (Reliable Data Protocol)                       | Надежный протокол передачи данных.               |
| 41           | IPv6 (encapsulation)                               | Инкапсуляция IPv6 в IPv4.                        |
| 47           | GRE (Generic Routing Encapsulation)                | Протокол туннелирования.                         |
| 50           | ESP (Encapsulating Security Payload)               | Протокол обеспечения конфиденциальности (IPsec). |
| 51           | AH (Authentication Header)                         | Протокол аутентификации (IPsec).                 |
| 88           | EIGRP (Enhanced Interior Gateway Routing Protocol) | Улучшенный протокол маршрутизации.               |
| 89           | OSPF (Open Shortest Path First)                    | Протокол маршрутизации.                          |
| 115          | L2TP (Layer Two Tunneling Protocol)                | Протокол туннелирования уровня 2.                |
| 132          | SCTP (Stream Control Transmission Protocol)        | Протокол передачи сообщений.                     |
| 255          | Зарезервировано                                    | Для будущего использования.                      |

* `Контрольная сумма заголовка (2 байта)` рассчитывается только по заголовку. Поскольку некоторые поля заголовка меняют
  свое значение в процессе передачи
  пакета по сети (например, поле времени жизни), контрольная сумма проверяется и повторно рассчитывается на каждом
  маршрутизаторе и конечном узле как дополнение к сумме
  всех 16-битных слов заголовка. При вычислении контрольной суммы значение самого поля
  контрольной суммы устанавливается в ноль. Если контрольная сумма неверна, то пакет
  отбрасывается, как только обнаруживается ошибка.
* `Поля IP-адресов источника и приемника имеют одинаковую длину — 32 бита.`
* `Поле параметров является необязательным и используется обычно только при отладке
  сети.` Это поле состоит из нескольких подполей одного из восьми предопределенных типов. В этих подполях можно
  указывать точный маршрут, по которому маршрутизаторы
  должны направлять данный пакет (то есть выполнять `маршрутизацию от источника`),
  регистрировать проходимые пакетом маршрутизаторы или помещать данные системы
  безопасности и временные отметки. Так как число подполей в поле параметров может быть
  произвольным, то в конце заголовка должно быть добавлено несколько нулевых байтов
  для выравнивания заголовка пакета по 32-битной границе.

![Структура заголовка IP-пакета](img/img.png)

### Функции IP:

* _Поддержание интерфейса с нижележащими технологиями_ подсетей является одной из важнейших функций протокола IP. В эти
  функции входит
  также _поддержание интерфейса с протоколами вышележащего транспортного уровня_, в частности с протоколом TCP, который
  решает все вопросы обеспечения надежной доставки данных по составной сети в стеке TCP/IP.
* Большая часть действий протокола связана с обработкой той служебной информации, которая переносится в полях заголовка
  пакета.

## IP маршрутизация, упрощённая таблица маршрутизации, таблица маршрутизации конечного хоста

![Схема разбираемой сети](img/img_1.png)

Используя условные обозначения для сетевых адресов маршрутизаторов и номеров сетей,
показанные на рисунке выше, посмотрим, как могла бы выглядеть таблица маршрутизации, например, в маршрутизаторе 4.

| **Адрес назначения** | **Сетевой адрес следующего маршрутизатора** | **Сетевой адрес выходного порта** | **Расстояние до сети назначения** |
|----------------------|---------------------------------------------|-----------------------------------|-----------------------------------|
| N1                   | IP12 (R1)                                   | IP41                              | 1                                 |
| N2                   | –                                           | IP41                              | 0 (подсоединена)                  |
| N3                   | IP12 (R1)                                   | IP41                              | 1                                 |
| N4                   | IP21 (R2)                                   | IP41                              | 1                                 |
| N5                   | –                                           | IP42                              | 0 (подсоединена)                  |
| N6                   | IP21 (R2)                                   | IP21                              | 2                                 |
| IPv                  | IP21 (R2)                                   | IP41                              | 2                                 |
| Маршрут по умолчанию | IP51 (R5)                                   | IP42                              | –                                 |

Первый столбец таблицы содержит адреса назначения пакетов.

В каждой строке таблицы следом за адресом назначения указывается **сетевой адрес следующего маршрутизатора** (точнее,
сетевой адрес интерфейса следующего маршрутизатора),
на который надо направить пакет, чтобы тот передвигался по направлению к заданному
адресу по рациональному маршруту.

Перед тем как передать пакет следующему маршрутизатору, текущий маршрутизатор
должен определить, на какой из нескольких собственных портов (IP41 или IP42) он должен
поместить данный пакет. Для этого служит третий столбец таблицы маршрутизации, содержащий **сетевые адреса выходных
интерфейсов.**

Некоторые реализации сетевых протоколов допускают наличие в таблице маршрутизации
сразу нескольких строк, соответствующих одному и тому же адресу назначения. В этом
случае при выборе маршрута принимается во внимание столбец, представляющий расстояние до сети назначения. При этом
расстояние измеряется в любой метрике, используемой в соответствии с заданным в сетевом пакете критерием. В таблице
расстояние между сетями измеряется хопами. Расстояние для сетей, непосредственно подключенных
к портам маршрутизатора, здесь принимается равным 0, однако в некоторых реализациях
отсчет расстояний начинается с 1.

Когда пакет поступает на маршрутизатор, модуль IP извлекает из его заголовка номер
сети назначения и последовательно сравнивает его с номерами сетей из каждой строки
таблицы. Строка с совпавшим номером сети показывает ближайший маршрутизатор, на
который следует направить пакет. Чаще всего в качестве адреса назначения
в таблице указывается не весь IP-адрес, а только номер сети назначения. Таким образом,
для всех пакетов, направляемых в одну и ту же сеть, протокол IP будет предлагать один
и тот же маршрут.

> Однако в некоторых случаях возникает необходимость для одного из узлов сети определить
> **специфический маршрут**, отличающийся от маршрута, заданного для всех остальных узлов
> сети. Для этого в таблицу маршрутизации помещают для данного узла отдельную строку, содержащую его полный IP-адрес и
> соответствующую маршрутную информацию.

Такого рода запись имеется в таблице для узла В. Предположим, администратор маршрутизатора 4, руководствуясь
соображениями безопасности, решил направить пакеты,
следующие в узел B (полный адрес IPB), через маршрутизатор 2 (интерфейс IP21), а не
маршрутизатор 1 (интерфейс IP12), через который передаются пакеты всем остальным
узлам сети N3. Если в таблице имеются записи о маршрутах как к сети в целом, так и к ее
отдельному узлу, то при поступлении пакета, адресованного данному узлу, маршрутизатор
отдаст предпочтение специфическому маршруту.

Поскольку пакет может быть адресован в любую сеть составной сети, может показаться,
что каждая таблица маршрутизации должна иметь записи обо всех сетях, входящих в составную сеть. Однако при таком подходе
в случае крупной сети объем таблиц маршрутизации может оказаться очень большим, что повлияет на время ее просмотра,
потребует
много места для хранения и т. п. Поэтому на практике широко известен прием уменьшения количества записей в таблице
маршрутизации, основанный на введении маршрута
по умолчанию (default route), учитывающего особенности топологии сети. Рассмотрим,
например, маршрутизаторы, находящиеся на периферии составной сети. В их таблицах
достаточно записать номера только тех сетей, которые непосредственно подсоединены
к данному маршрутизатору или расположены поблизости на тупиковых маршрутах. Обо
всех остальных сетях можно сделать в таблице единственную запись, указывающую на
маршрутизатор, через который пролегает путь ко всем этим сетям. Такой маршрутизатор
называется маршрутизатором по умолчанию (default router). В нашем примере на маршрутизаторе 4 имеются специфические
маршруты только для пакетов, следующих в сети
N1–N6. Для всех остальных пакетов, адресованных в сети N7–N18, маршрутизатор предлагает продолжить путь через один и тот
же порт IP51 маршрутизатора 5, который в данном
случае и является маршрутизатором по умолчанию.

## IP маршрутизация: без масок, на основе масок

Протокол IP извлекает из пакета IP-адрес назначения (предположим, адрес назначения IPB).

1. Выполняется первая фаза просмотра таблицы — поиск специфического маршрута
   к узлу. IP-адрес (целиком) последовательно, строка за строкой, сравнивается с содержимым поля адреса назначения
   таблицы маршрутизации. Если произошло совпадение
   (как в табл. 14.1), то из соответствующей строки извлекаются адрес следующего маршрутизатора (IP21) и идентификатор
   выходного интерфейса (IP41). На этом просмотр
   таблицы заканчивается.
2. Предположим теперь, что в таблице нет строки с адресом назначения IPB, а значит,
   совпадения не произошло. В этом случае протокол IP переходит ко второй фазе просмотра — поиску маршрута к сети
   назначения. Из IP-адреса выделяется номер сети
   (в нашем примере из адреса IPB выделяется номер сети N3), после чего таблица снова
   просматривается на предмет совпадения номера сети в какой-либо строке с номером
   сети из пакета. При совпадении (а в нашем примере оно произошло) из соответствующей строки таблицы извлекаются адрес
   следующего маршрутизатора (IP12) и идентификатор выходного интерфейса (IP41). Просмотр таблицы на этом завершается.
3. Наконец, предположим, что адрес назначения в пакете был таков, что совпадения не
   произошло ни в первой, ни во второй фазах просмотра. В таком случае средствами
   протокола IP либо выбирается маршрут по умолчанию (и пакет направляется по
   адресу IP51), либо, если маршрут по умолчанию отсутствует, пакет отбрасывается.
   Просмотр таблицы на этом заканчивается.

#### ВНИМАНИЕ

> Последовательность фаз в данном алгоритме строго определена, в то время как последовательность
> просмотра или, что одно и то же, порядок расположения строк в таблице, включая запись о маршруте
> по умолчанию, никак не сказывается на результате.

## Схема протоколов модели OSI

## Протокол ICMP, структура кадра, типы сообщений, коды ошибок

> `Протокол межсетевых управляющих сообщений (Internet Control Message Protocol, ICMP)`
> является вспомогательным протоколом, использующимся для диагностики и мониторинга сети.

Протокол ICMP также призван компенсировать ненадежность протокола IP, но несколько
иным образом. Он не предназначен для _исправления_ возникших при передаче пакета проблем: если пакет потерян, то ICMP не
может послать его заново.
> ICMP-пакет является средством оповещения отправителя о «несчастных случаях», произошедших с его
> пакетами.

Пусть, например, протокол IP, работающий на каком-либо маршрутизаторе, обнаружил, что пакет для дальнейшей передачи по
маршруту необходимо фрагментировать,
но в пакете установлен признак DF (не фрагментировать). В таком случае протокол IP,
прежде чем отбросить пакет, отправляет диагностическое ICMP-сообщение конечному
узлу-источнику. ICMP-сообщение передается по сети в поле данных IP-пакета. IP-адрес
узла-источника определяется из заголовка исходного пакета, вызвавшего инцидент.

> Важно, что обработка ICMP-сообщений не входит в обязанности протоколов IP и ICMP.

### Формат, типы и коды ICMP-сообщений

Особенностью протокола ICMP является функциональное разнообразие решаемых задач,
а следовательно, и связанных с этим сообщений. Все типы сообщений имеют один и тот же
формат (рис. 14.14), однако интерпретация полей существенно зависит от того, к какому
типу относится сообщение.

![Формат ICMP-сообщения](img/img_2.png)

Заголовок ICMP-сообщения состоит из 8 байт:
*тип (1 байт) — числовой идентификатор типа сообщения

* код (1 байт) — числовой идентификатор, более тонко дифференцирующий тип ошибки
* контрольная сумма (2 байта) — подсчитывается для всего ICMP-сообщения.

> Содержимое оставшихся 4 байт в заголовке и поле данных зависит от значений полей типа и кода.

На рис. 14.15 показана таблица основных типов ICMP-сообщений. Эти сообщения можно
разделить на две группы:

* сообщения об ошибках;
* сообщения запрос-ответ (отмечены в таблице темным фоном).

![Типы ICMP-сообщений](img/img_3.png)

Сообщения типа «запрос-ответ» связаны в пары: «эхо-запрос — эхо-ответ», «запрос маски — ответ маски», «запрос отметки
времени — ответ отметки времени». Важную роль
в работе маршрутизируемой сети играет пара сообщений «запрос маршрутизатора» (router
solicitation) и «объявление маршрутизатора» (router advertisement), которые позволяют
хостам и маршрутизаторам находить друг друга.

Сообщение об ошибках может быть вызвано
различными причинами: неверный адрес сети или конечного узла (код 0 или 1), отсутствие
на конечном узле-адресате необходимого протокола прикладного уровня (код 2 — «протокол недостижим») или открытого порта
UDP/TCP (код 3 — «порт недостижим»). Узел
(или сеть) назначения может быть также недостижим по причине временной неработоспособности аппаратуры или из-за того,
что маршрутизатор не имеет данных о пути к сети
назначения. Всего таблица содержит 15 кодов. Аналогичные таблицы кодов существуют
и для других типов сообщений об ошибках.

## Протоколы TCP/UDP мультиплексировени и демультиплексирование, сокеты

### Мультиплекирование и демультиплексирование приложений

Реализуемая протоколами TCP и UDP процедура распределения между прикладными процессами пакетов, поступающих от сетевого
уровня,
называется `демультиплексированием`.

Существует и обратная задача: данные, генерируемые разными приложениями, работающими на одном конечном узле, должны быть
переданы общему для всех них протокольному модулю IP для последующей отправки в сеть. Эту работу, называемую
`мультиплексированием`, тоже выполняют протоколы
TCP и UDP.

![Мультиплексирование и демультиплексирование на транспортном уровне](img/img_4.png)

### Сокеты

> Прикладной процесс однозначно определяется в пределах сети и в пределах отдельного компьютера парой (IP-адрес, номер
> порта), называемой сокетом (socket). Сокет, определенный
> IP-адресом и номером UDP-порта, называется UDP-сокетом, а IP-адресом и номером TCP-
> порта — TCP-сокетом.

После получения IP-пакета от протокола
канального уровня протокол IP анализирует содержимое заголовка этого пакета, после
чего заголовок отбрасывается, а «наверх» передается содержимое поля данных IP-пакета,
например UDP-дейтаграмма. Упрощение состоит в том, что вместе с содержимым поля данных на транспортный уровень
передается извлеченный из заголовка IP-адрес назначения,
который и используется для однозначной идентификации приложения.

## Протокол UDP, структура кадра

Протокол UDP, подобно IP, является дейтаграммным протоколом, реализующим так называемый ненадежный сервис `по
возможности`, который не гарантирует доставку сообщений
адресату.

Протокол UDP добавляет к каждому отдельному сообщению свой 8-байтный заголовок, формируя из этих сообщений собственные
протокольные единицы, называемые `UDP-дейтаграммами`, и передает их нижележащему
протоколу IP. В этом и заключаются его функции по _мультиплексированию данных._

![Работа протокола UDP на хосте-отправителе](img/img_5.png)

### Заголовок UDP состоит из четырех двухбайтных полей:

* номер UDP-порта отправителя;
* номер UDP-порта получателя;
* контрольная сумма;
* длина дейтаграммы.

Функции сводятся к простой передаче данных между прикладным и сетевым уровнями, а также
примитивному контролю искажений в передаваемых данных. При контроле искажений
протокол UDP только _диагностирует, но не исправляет ошибку._ Если контрольная сумма
показывает, что в поле данных UDP-дейтаграммы произошла ошибка, то протокол UDP
просто отбрасывает поврежденную дейтаграмму.

Работая на хосте-получателе, протокол UDP принимает от протокола IP извлеченные
из пакетов UDP-дейтаграммы. Полученные из IP-заголовка IP-адрес назначения и из
UDP-заголовка номер порта используются для формирования UDP-сокета, однозначно
идентифицирующего приложение, которому направлены данные. Протокол UDP освобождает дейтаграмму от UDP-заголовка.
Полученное в результате сообщение он передает
приложению на соответствующий UDP-сокет. Таким образом, протокол UDP выполняет
_демультиплексирование_ на основе сокетов.

## Протокол TCP, структура кадра, схема логического содеинения в TCP

> Протокол TCP предназначен для передачи данных между приложениями. Этот протокол основан
> на логическом соединении, что позволяет ему обеспечивать гарантированную доставку данных,
> используя в качестве инструмента ненадежный дейтаграммный сервис протокола IP.

При работе на хосте-отправителе протокол TCP рассматривает информацию, поступающую к нему от прикладных процессов, как
_неструктурированный_ поток байтов.

Поступающие данные буферизуются средствами TCP. Для передачи на сетевой уровень из
буфера «вырезается» некоторая непрерывная часть данных, которая называется `сегментом`
и снабжается заголовком.

![Формирование TCP-сегментов из потока байтов](img/img_6.png)

Формат заголовка TCP-сегмента:

![Формат заголовка TCP-сегмента](img/img_7.png)

### Примечание

> В отличие от протокола UDP, создающего дейтаграммы на основе логически обособленных единиц
> данных (сообщений, генерируемых приложениями), протокол TCP делит поток данных на сегменты
> без учета их смысла или внутренней структуры.


Значение однобитных полей, называемых **флагами**, или **кодовыми
битами** (code bits). Они расположены сразу за резервным полем и содержат служебную
информацию о типе данного сегмента. Положительное значение сигнализируется установкой этих битов в единицу:

* `URG` — срочное сообщение;
* ``ACK`` — квитанция на принятый сегмент;
* `PSH` — запрос на отправку сообщения без ожидания заполнения буфера;
* `RST` — запрос на сброс соединения;
* `SYN` — сообщение, используемое для синхронизации счетчиков переданных данных при установлении соединения;
* ``FIN`` — признак достижения передающей стороной последнего байта в потоке передаваемых данных.

## Протокол TCP, схeма состояний

Соединение устанавливается по инициативе клиентской части приложения. При необходимости выполнить обмен данными с
серверной частью приложение-клиент обращается
к нижележащему протоколу TCP, который в ответ на это обращение посылает сегмент запрос на установление соединения
протоколу TCP, работающему на стороне сервера. В числе прочего в запросе содержится флаг SYN, установленный в 1.

![Процедура установления и разрыва логического соединения при нормальном течении процесса](img/img_8.png)

Получив запрос, модуль TCP на стороне сервера пытается создать «инфраструктуру» для обслуживания нового клиента. Он
обращается к ОС с просьбой о выделении
определенных системных ресурсов для организации буферов, таймеров, счетчиков.
Эти ресурсы закрепляются за соединением с момента создания и до момента разрыва.
Если на стороне сервера все необходимые ресурсы были получены и все необходимые
действия выполнены, то модуль TCP посылает клиенту сегмент с флагами ``ACK`` и `SYN`.
В ответ клиент посылает сегмент с флагом ``ACK`` и переходит в состояние установленного логического соединения (
состояние
`ESTABLISHED`). Получив флаг `ACK`, сервер
также переходит в состояние `ESTABLISHED`. На этом процедура установления соединения заканчивается, и стороны могут
переходить к обмену данными. Соединение
может быть разорвано в любой момент по инициативе любой стороны. Для этого клиент
и сервер должны обменяться сегментами `FIN` и `ACK` в последовательности, показанной
на рис. 15.7, б (здесь инициатором является клиент). Соединение считается закрытым
по прошествии некоторого времени, в течение которого сторона-инициатор убеждается,
что ее завершающий сигнал `ACK` дошел нормально и не вызвал никаких «аварийных»
сообщений со стороны сервера.

> Логическое TCP-соединение однозначно идентифицируется парой сокетов, определенных для
> этого соединения двумя взаимодействующими процессами.

Для каждой пары клиент-сервер протоколом TCP создается _отдельное логическое соединение._


> Протокол TCP осуществляет демультиплексирование информации, поступающей на прикладной
> уровень, на основе _соединений процессов_ или, что одно и то же, на основе идентифицирующих
> эти процессы _пар сокетов._

## Классификация протоколов маршрутизации

### Проколы маршрутизации не требующие наличия _таблиц маршрутизации на маршрутизаторах_:

* Метод **Лавинной маршрутизации** заключается в том, что каждый маршрутизатор передает пакет всем своим
  непосредственным
  соседям, исключая тот, от которого его получил.

* **Маршрутизация от источника** (source routing). В этом случае отправитель помещает в пакет информацию о том, какие
  промежуточные маршрутизаторы должны участвовать в передаче пакета к сети назначения. На основе этой информации каждый
  маршрутизатор считывает адрес следующего маршрутизатора, и если он действительно является адресом его
  непосредственного соседа, то передает ему пакет для дальнейшей обработки. Маршрут может задавать либо вручную
  администратор, либо автоматически узел-отправитель, но в этом случае ему нужно поддерживать какой-либо протокол
  маршрутизации, который сообщит ему о топологии и состоянии сети.

### Протоколы маршрутизации требующие наличия таблиц маршрутизации на маршрутизаторах:

Выбор рационального маршрута может осуществляться на основании различных _критериев_. Сегодня в IP-сетях применяются
протоколы маршрутизации, в которых маршрут выбирается по критерию кратчайшего расстояния. При этом расстояние измеряется
в различных метриках. Чаще всего используется простейшая метрика — количество хопов, то есть количество маршрутизаторов,
которые нужно преодолеть пакету
до сети назначения. В качестве метрик применяются также пропускная способность и надежность каналов, вносимые ими
задержки и любые комбинации этих метрик.

Задачей протоколов маршрутизации является создание на всех маршрутизаторах _согласованных_ друг с другом таблиц
маршрутизации, то есть таких таблиц, которые обеспечат
доставку пакета от исходной сети в сеть назначения за конечное число шагов.
Различают протоколы, выполняющие статическую и адаптивную (динамическую) маршрутизацию.

* При **статической маршрутизации** все записи в таблице имеют неизменяемый, статический статус, что подразумевает
  бесконечный срок их жизни. Записи о маршрутах составляются и вводятся в память каждого маршрутизатора _вручную
  администратором сети_. При изменении состояния сети администратору необходимо срочно отразить эти изменения в
  соответствующих таблицах маршрутизации, иначе может произойти их рассогласование и сеть будет работать некорректно.

* При **адаптивной маршрутизации** все изменения конфигурации сети автоматически отражаются в таблицах маршрутизации
  благодаря _протоколам маршрутизации._ Эти протоколы собирают информацию о топологии связей в сети, что позволяет им
  оперативно отражать все текущие изменения. В таблицах маршрутизации при адаптивной маршрутизации обычно имеется
  информация об интервале времени, в течение которого данный маршрут будет оставаться действительным. Это время называют
  _временем жизни_ (TTL) маршрута. Если по истечении времени жизни существование маршрута не подтверждается протоколом
  маршрутизации, то он считается нерабочим, и пакеты по нему больше не посылаются.

### Протоколы адаптивной маршрутизации бывают распределенными и централизованными:

* При распределенном подходе все маршрутизаторы сети находятся в равных условиях, они находят маршруты и строят
  собственные таблицы маршрутизации, работая в тесной кооперации друг с другом, постоянно обмениваясь информацией о
  конфигурации сети.

* При централизованном подходе в сети существует один выделенный маршрутизатор, собирающий всю информацию о топологии и
  состоянии сети от других маршрутизаторов. На основании этих данных выделенный маршрутизатор (иногда называемый
  сервером маршрутов) строит таблицы маршрутизации для остальных маршрутизаторов сети, распространяя их затем по сети,
  чтобы каждый маршрутизатор получил собственную таблицу и в дальнейшем самостоятельно принимал решение о продвижении
  каждого пакета. Централизованный подход порождает более рациональные маршруты потоков, чем распределенный, так как
  решения принимаются на основе полной и непротиворечивой информации о топологии связей сети. Но его недостатком
  является плохая масштабируемость.

Из-за этого недостатка в Интернете доминировали и продолжают доминировать децентрализованные протоколы маршрутизации,
но их решения не всегда дают такие же рациональные маршруты, как решения центрального элемента, так как они основаны
на информации, полученной из третьих рук — от своих соседей, которые в свою очередь получили ее от своих соседей.

Еще одним недостатком распределенных протоколов маршрутизации является существование периодов нестабильной работы сети,
вызванной временной несогласованностью таблиц разных маршрутизаторов. Распределенному протоколу маршрутизации обычно
нужно некоторое время — **время конвергенции**, чтобы после нескольких итераций обмена служебной информацией все
маршрутизаторы сети внесли изменения в свои таблицы, в результате чего они снова стали бы согласованными. Отметим,
различные протоколы маршрутизации обладают разным _временем конвергенции._

> Применяемые сегодня в IP-сетях протоколы маршрутизации относятся к адаптивным распределенным протоколам, которые в
> свою очередь делятся на две группы:
> * дистанционно-векторные алгоритмы (Distance Vector Algorithm, DVA);
> * алгоритмы состояния связей (Link State Algorithm, LSA).

* В `дистанционно-векторных алгоритмах (DVA)` каждый маршрутизатор периодически и широковещательно рассылает по сети
  вектор, компонентами которого являются расстояния (дистанции), измеренные в той или иной метрике, от данного
  маршрутизатора до всех известных ему сетей. Пакеты протоколов маршрутизации обычно называют **объявлениями о
  расстояниях**, так как с их помощью маршрутизатор объявляет остальным маршрутизаторам известные ему сведения о
  конфигурации сети. Получив от некоторого
  соседа вектор расстояний до известных тому сетей, маршрутизатор наращивает компоненты вектора на величину расстояния
  от себя до данного соседа и дополняет вектор информацией об известных ему самому других сетях, о которых он узнал
  непосредственно (если они подключены к его портам) или из аналогичных объявлений других маршрутизаторов. Обновленное
  значение вектора маршрутизатор рассылает своим соседям. В конце концов каждый маршрутизатор получает через соседние
  маршрутизаторы информацию обо всех имеющихся в составной сети сетях и о расстояниях до них и выбирает из нескольких
  альтернативных маршрутов к каждой сети маршрут, обладающий наименьшим значением метрики. Маршрутизатор, передавший
  информацию о данном маршруте, отмечается в таблице маршрутизации как _следующий_ (next hop).

  > Дистанционно-векторные алгоритмы хорошо работают только в небольших сетях. В больших сетях они периодически засоряют
  линии связи интенсивным трафиком, к тому же изменения конфигурации не всегда корректно могут отражаться алгоритмом
  этого типа, так как маршрутизаторы не имеют точного представления о топологии связей в сети, а располагают только
  косвенной информацией — вектором расстояний.

* Алгоритмы состояния связей (LSA) обеспечивают каждый маршрутизатор информацией, достаточной для построения точного
  графа связей сети. Все маршрутизаторы работают на основании одного и того же графа, что делает процесс маршрутизации
  более устойчивым к изменениям конфигурации. Каждый маршрутизатор использует граф сети для нахождения оптимальных по
  некоторому критерию маршрутов до каждой из сетей, входящих в составную сеть. Чтобы понять, в каком состоянии находятся
  линии связи, подключенные к его портам, маршрутизатор периодически обменивается короткими пакетами HELLO со своими
  непосредственными соседями. В отличие от протоколов DVA, которые регулярно передают вектор расстояний, протоколы LSA
  ограничиваются короткими сообщениями, а передача более объемных сообщений происходит только в тех случаях, когда с
  помощью сообщений HELLO был установлен факт изменения состояния какой-либо связи.

  > Cлужебный трафик, создаваемый протоколами LSA, гораздо менее интенсивный, чем у протоколов DVA. Протоколами,
  основанными на алгоритме состояния связей, являются протокол IS-IS стека OSI (этот протокол используется также в стеке
  TCP/IP) и протокол OSPF стека TCP/IP.

## Протокол RIP, время жизни пакетов, зацикливание пакетов

`Протокол маршрутной информации RIP (Routing Information Protocol)` является протоколом маршрутизации
дистанционно-векторного типа и чаще всего используется в небольших сетях. Для IP-сетей имеются две версии RIP — RIPv1 (
не поддерживает маски) и RIPv2(поддерживает маски). Так как способ построения таблиц маршрутизации в обеих версиях
протокола принципиально не отличается.

Для измерения расстояния до сети стандарты протокола RIP допускают различные метрики: хопы, значения пропускной
способности, вносимые задержки, надежность сетей (то есть соответствующие признакам D, T и R в поле качества сервиса
IP-пакета), а также любые комбинации этих метрик. Метрика должна обладать свойством аддитивности — метрика составного
пути должна быть равна сумме метрик составляющих этого пути. В большинстве реализаций RIP используется простейшая
метрика — количество хопов, то есть количество промежуточных маршрутизаторов, которые нужно преодолеть пакету до сети
назначения.

Таблица маршрутизации в протоколе RIP строится следующим образом:

Основные этапы:

1. Создание минимальной таблицы маршрутизации:

    * На этапе инициализации каждый маршрутизатор создает минимальную таблицу, содержащую записи только для сетей,
      непосредственно подключенных к нему. Эти данные автоматически добавляются в таблицу маршрутизации.

2. Рассылка минимальной таблицы соседям:

    * Каждый маршрутизатор передает информацию о своих известных маршрутах соседним маршрутизаторам. Информация включает
      IP-адрес сети и расстояние до нее (в хопах). Например, маршрутизатор R1 передает маршрутизаторам R2 и R3 данные о
      своих подключенных сетях с расстоянием 1.

3. Получение сообщений от соседей и обработка данных:

    * После получения сообщений RIP от соседей маршрутизатор обновляет свои таблицы маршрутизации. Каждое новое
      расстояние до сети увеличивается на 1 хоп, и информация сравнивается с уже существующей. Если новая метрика
      лучше (
      меньшее расстояние), она заменяет старую запись.

4. Рассылка обновленных таблиц маршрутизации:

    * После обработки информации маршрутизатор отправляет обновленную таблицу всем соседям. Процесс повторяется, пока
      все
      маршрутизаторы в сети не получат актуальную информацию обо всех доступных сетях.

5. Корректировка и удаление устаревших записей:

    * Для обеспечения актуальности таблиц маршрутизации используется механизм “истечения времени жизни маршрута”. Если в
      течение установленного времени (180 секунд) не поступает подтверждений о маршруте, запись считается
      недействительной
      и удаляется из таблицы.

Пример:

Для маршрутизатора R1 минимальная таблица может выглядеть так:

* Сеть: 201.36.14.0, Следующий маршрутизатор: 201.36.14.3, Расстояние: 1 хоп.

В процессе обмена данными таблица будет дополнена маршрутами к другим сетям через соседние маршрутизаторы, а также
оптимизирована для выбора кратчайших путей.

### Проблема зацикливания

Зацикливание пакетов в RIP возникает, когда информация о недоступности маршрута распространяется медленно из-за
особенностей протокола, что может привести к тому, что маршрутизаторы продолжают направлять трафик через устаревшие
маршруты. Это может привести к формированию маршрутных петель, в которых пакеты циркулируют бесконечно между
маршрутизаторами.

Пример:

* Если маршрутизатор R1 обнаруживает, что его связь с сетью 201.36.14.0 потеряна, он помечает сеть как недоступную.
  Однако до того, как R1 передаст эту информацию соседям, маршрутизатор R2 может отправить R1 устаревшую информацию,
  считая, что путь к сети 201.36.14.0 доступен через себя. R1 обновляет таблицу, основываясь на этой неверной
  информации,
  и зацикливание продолжается

### Механизмы предотвращения зацикливания в RIP

Чтобы минимизировать вероятность зацикливания и его последствия, в RIP применяются следующие методы:

1. Ограничение максимального расстояния (15 хопов):
    * Если расстояние до сети становится больше 15, сеть считается недоступной. Это ограничивает продолжительность
      циркуляции пакетов, так как зацикливание невозможно для недостижимых маршрутов
2. Split Horizon (разделение горизонта):
    * Маршрутизатор не отправляет информацию о маршруте тому соседу, от которого эта информация была получена. Это
      предотвращает “обратную волну” ложной информации
3. Poison Reverse (ядовитый маршрут):
    * Если маршрут становится недоступным, маршрутизатор отправляет соседям обновление с метрикой, равной 16 (
      бесконечность), что предотвращает использование данного маршрута
4. Holddown Timer (замораживание изменений):
    * При выявлении изменения состояния маршрута он “замораживается” на определенный интервал времени, предотвращая
      принятие новых обновлений от соседей. Это снижает вероятность добавления ложной информации в таблицы
5. Triggered Updates (триггерные обновления):
    * Вместо ожидания очередного цикла отправки таблиц маршрутизации (30 секунд), RIP немедленно отправляет обновление
      при обнаружении изменения состояния сети. Это позволяет быстрее уведомлять соседей о проблемах

## Протокол BGP

`Пограничный (внешний) шлюзовой протокол (Border Gateway Protocol, BGP)` в версии 4
является сегодня основным протоколом обмена маршрутной информацией между автономными системами Интернета. BGP успешно
работает при любой топологии связей между
автономными системами, что соответствует современному состоянию Интернета.

Маршрутизатор взаимодействует с другими маршрутизаторами по протоколу BGP только
в том случае, если администратор _явно_ указывает при конфигурировании, что эти маршрутизаторы являются его _соседями_.

Для установления сеанса с указанными соседями маршрутизаторы BGP используют протокол TCP (порт 179). При установлении
BGP-сеанса могут применяться разнообразные
способы аутентификации маршрутизаторов, повышающие безопасность работы автономных систем. Основное сообщение протокола
BGP — сообщение UPDATE (обновить),
с помощью которого маршрутизатор сообщает маршрутизатору соседней автономной
системы о достижимости сетей, относящихся к его собственной автономной системе.
Само название этого сообщения говорит о том, что это триггерное объявление, посылаемое соседу, если в топологии
автономной системы происходят изменения: появляются
новые сети или новые пути к сетям либо же, напротив, исчезают существовавшие сети
или пути. В одном сообщении UPDATE можно объявить об одном новом маршруте или
аннулировать несколько маршрутов, переставших существовать. Под маршрутом в BGP
понимается последовательность автономных систем, которую нужно пройти на пути
к указанной в адресе сети. Формальная запись о маршруте (BGP Route) к сети (Network/
Mask_length) выглядит так:

`BGP Route = AS_Path; NextHop; Network/Mask_length;`

Здесь AS_Path — набор номеров автономных систем, NextHop — IP-адрес маршрутизатора, через который нужно передавать
пакеты в сеть Network/Mask_length.

Отличия iBGP(Interior BGP, внутренняя версия BGP) и eBGP(Exterior BGP, внешняя версия BGP):

1. Область применения:
    * iBGP: используется внутри одной автономной системы (AS). Его задача — распространение информации о внешних
      маршрутах между маршрутизаторами внутри AS.
    * eBGP: используется для обмена маршрутами между разными автономными системами. Он отвечает за передачу информации о
      доступных сетях и политик маршрутизации между AS.
2. Формирование маршрутов:
    * В iBGP маршрутизаторы передают информацию друг другу без изменений. При этом маршрутизатор не изменяет AS_Path (
      последовательность автономных систем, через которые проходит маршрут).
    * В eBGP маршрутизатор добавляет номер своей автономной системы в AS_Path перед отправкой информации соседу. Это
      помогает избежать зацикливания маршрутов.
3. Режимы работы и требования:
    * iBGP требует установки соединения между всеми маршрутизаторами внутри AS (полнографовой топологии) либо применения
      таких решений, как маршрутизаторы Route Reflector.
    * eBGP предполагает прямое взаимодействие между маршрутизаторами на границе автономных систем.
4. Протоколы взаимодействия:
    * iBGP интегрируется с внутренними протоколами маршрутизации (например, OSPF, IS-IS), которые обеспечивают доставку
      пакетов внутри AS.
    * eBGP используется исключительно для межсетевых взаимодействий, определяя пути на основе политик и договоренностей
      между автономными системами.

## Общие принципы построения служб

## URI, URL, URN

### URL

Браузер находит веб-страницы и отдельные объекты по адресам специального формата,
называемым `URL`
(Uniform Resource Locator — унифицированный указатель ресурса).

URL-адрес может выглядеть, например, так: http://www.olifer.co.uk/books/books.htm. В URL- адресе можно выделить три
части:

* Тип протокола доступа. Помимо HTTP, здесь могут быть указаны и другие протоколы, такие как FTP, telnet, также
  позволяющие осуществлять удаленный доступ к файлам или компьютерам. Тем не менее основным протоколом доступа к
  веб-страницам является HTTP.
* DNS-имя сервера. Это имя сервера, на котором хранится нужная страница. В нашем случае — это имя
  сайта www.olifer.co.uk.
* Путь к объекту. Обычно это составное имя файла (объекта) относительно главного каталога веб-сервера, предлагаемого по
  умолчанию. В нашем случае главным каталогом является /books/books.htm. По расширению файла мы можем сделать вывод о
  том, что это HTML-файл.

### URI

URI (Uniform Resource Identifier — унифицированный идентификатор ресурса)

URI — это строка символов, используемая для идентификации ресурса в Интернете. URI может быть как локатором (URL), так и
именем (URN), или сочетать в себе обе функции.

Пример URI: urn:isbn:0451450523

В URI можно выделить следующие части:

* Схема: определяет тип идентификатора и указывает, как интерпретировать оставшуюся часть URI. В данном примере схема —
  urn, что означает, что используется унифицированное имя ресурса.
* Идентификатор пространства имен (NID): указывает на конкретное пространство имен, в рамках которого уникально
  идентифицируется ресурс. В данном случае — isbn, что относится к Международному стандартному книжному номеру.
* Специфичный для пространства имен компонент (NSS): уникальный идентификатор ресурса в рамках указанного пространства
  имен. В данном примере — 0451450523, что является конкретным ISBN книги.

## URN

URN (Uniform Resource Name — унифицированное имя ресурса)

URN — это тип URI, который служит для постоянной, независимой от местоположения идентификации ресурса. В отличие от URL,
URN не предоставляет информации о том, как найти или получить доступ к ресурсу; он лишь однозначно идентифицирует его.

Пример URN: urn:ietf:rfc:2648

В этом URN:

* Схема: urn
* Идентификатор пространства имен (NID): ietf, указывающий на пространство имен Интернет-инженерной рабочей группы.
* Специфичный для пространства имен компонент (NSS): rfc:2648, что ссылается на документ RFC 2648.

Сравнение URI, URL и URN

* URI: универсальный идентификатор ресурса, который может быть как локатором (URL), так и именем (URN), или сочетать обе
  функции.
* URL: подмножество URI, которое предоставляет способ нахождения ресурса, описывая его местоположение в сети и способ
  доступа к нему.
* URN: подмножество URI, которое предоставляет уникальное и постоянное имя ресурса без указания его местоположения или
  способа доступа.

Таким образом, каждый URL и URN является URI, но не каждый URI является URL или URN.

## Протокол HTTP, веб-клиент, веб-сервер, заголовки, cookie

> Клиентская часть веб-службы, или веб-клиент, называемый также браузером, представляет собой приложение, которое
> устанавливается на компьютере конечного пользователя и предназначено для просмотра веб-страниц.

Одной из важных функций браузера является _поддержание графического пользовательского
интерфейса._ Через интерфейс пользователь получает доступ к широкому набору услуг,
главная из которых, конечно, «веб-серфинг», включающий поиск и просмотр страниц,
навигацию между уже просмотренными страницами, переход по закладкам и хранение
истории посещений. Помимо средств просмотра и навигации, веб-браузер предоставляет пользователю возможность
_манипулирования страницами:_ сохранение их в файле на
диске своего компьютера, вывод на печать, передача по электронной почте, контекстный
поиск в пределах страницы, изменение кодировки и формата текста, а также множество
других функций, связанных с представлением информации на экране и настройкой самого браузера.

> Веб-сервер — это программа, хранящая объекты локально в каталогах компьютера, на котором
> она запущена, и обеспечивающая доступ к этим объектам по URL-адресам. Наиболее популярными веб-серверами сейчас
> являются Apache и Microsoft Internet Information Server.


Как и любой другой сервер, веб-сервер должен быть постоянно в активном состоянии,
прослушивая _TCP-порт 80,_ являющийся назначенным портом протокола HTTP. С получением запроса от клиента сервер
устанавливает TCP-соединение и получает от клиента
имя объекта, например, в виде /books/books.htm, после чего находит в своем каталоге этот
файл, а также другие связанные с ним объекты, и отсылает их по TCP-соединению клиенту. Получив объекты от сервера,
веб-браузер отображает их на экране. После
отправки всех объектов страницы клиенту сервер разрывает с ним TCP-соединение. В дополнительные функции сервера входят
также аутентификация клиента и проверка прав
доступа данного клиента к данной странице.

### Протокол HTTP

HTTP (HyperText Transfer Protocol — протокол передачи гипертекста) — это протокол прикладного уровня, во многом
аналогичный протоколам FTP и SMTP. Существует несколько
версий этого протокола: HTTP 1.0, HTTP 1.1, HTTP/2 и HTTP/3.
Обмен сообщениями идет по обычной схеме «запрос-ответ». Клиент и сервер обмениваются _текстовыми_ сообщениями
стандартного
формата, то есть каждое сообщение представляет собой несколько строк обычного текста в кодировке ASCII. Для
транспортировки HTTP-сообщений служит протокол TCP. При этом TCP-соединения могут использоваться двумя разными
способами:

* `Долговременное соединение` — передача в одном TCP-соединении нескольких объектов,
  причем время существования соединения определяется при конфигурировании веб-службы.
* `Кратковременное соединение` — передача в рамках одного TCP-соединения только
  одного объекта.

Долговременное соединение, в свою очередь, может быть использовано двумя способами:

* `Последовательная передача запросов с простоями` — это способ, посредством которого новый запрос посылается только
  после
  получения ответа.
* `Конвейерная передача` — это более эффективный способ, в котором следующий за прос посылается до прибытия ответа на
  один
  или несколько предыдущих запросов(напоминает метод скользящего окна). Обычно по умолчанию степень параллелизма
  устанавливается на уровне 5–10, но у пользователя имеется возможность изменять этот параметр при конфигурировании
  клиента.

В версии HTTP 1.0 поддерживается только режим кратковременных соединений, когда
после передачи одного запроса и получения ответа TCP-соединение закрывается. Такой
режим полностью соответствует концепции сервера без сохранения состояния, а это, как
уже отмечалось, приводит к замедлению работы браузера и увеличению трафика из-за
частого выполнения процедуры трехэтапного установления TCP-соединения.

В версии HTTP 1.1 по умолчанию применяются постоянные соединения и конвейерный
режим. Соединение разрывается по инициативе либо браузера, либо сервера за счет отиспользует таймер неактивности
пользователя для того, чтобы разорвать соединение по
тайм-ауту и не тратить ресурсы памяти на неактивные соединения.

Версия HTTP/2 ускорила процесс построения веб-браузером веб-страницы, сохранив
в целом синтаксис и семантику сообщений версий HTTP 1.0 и 1.1. Ускорение достигается
за счет нескольких усовершенствований механизма передачи запросов и ответов между
веб-браузером и веб-сервером:

* вместо использования отдельных TCP-соединений для передачи каждого запроса и ответа, приводившего к простоям из-за
  того, что новый запрос не может быть послан без
  получения ответа, теперь используется одно TCP-соединение для мультиплексирования нескольких запросов, которые могут
  быть посланы практически одновременно;
* приоритезация запросов к веб-серверу, благодаря которой сервер знает, какой запрос более важен веб-браузеру для
  построения страницы;
* введение режима Server Push, при котором веб-сервер может передать веб-браузеру не только запрашиваемые ресурсы, но и
  те, которые, по мнению веб-сервера, скоро понадобятся веб-браузеру;
* компрессия заголовков сообщений HTTP, значительно сокращающая длину сообщения за счет компрессии таких потенциально
  длинных полей, как куки.

Новая версия HTTP/3 (не стандартизованная на момент написания книги) должна прийти
на смену HTTP/2, заменив протокол TCP на новый протокол QUIC, являющийся
транспортным протоколом, работающим поверх UDP, и более быстро, чем TCP, устанавливающая соединения и обрабатывающая
потерю и искажения данных. Протокол QUIC
первоначально был разработан компанией Google и уже применяется в браузере Chrome
этой компании.

### Формат HTTP-сообщений

В протоколе HTTP все сообщения состоят из текстовых строк. HTTP-сообщения бывают
двух типов — запросы и ответы, — имеющих единую обобщенную структуру, состоящую
из трех частей: обязательной стартовой строки, а также необязательных заголовков и тела
сообщения.

Стартовая строка запроса включает в себя
поле метода — это название операции, которая должна быть выполнена. Чаще всего в запросах используется метод `GET`, то
есть запрос объекта (именно он включен в наш пример
запроса).

* Метод `HEAD` аналогичен методу `GET`, но запрашиваются только метаданные заголовка
  HTML-страницы.
* Метод `POST` используется клиентом для отправки данных на сервер: сообщений электронной почты, ключевых слов в запросе
  поиска, веб-формы.
* Метод `PUT` используется клиентом для размещения некоторого объекта на сервере, на
  который указывает URL-адрес.
* Метод `DELETE` указывает серверу на то, что некоторый объект на сервере, определяемый
  URL-адресом, необходимо удалить.

![Методы HTTP](img/img_9.png)

Методы `GET` и `HEAD` считаются безопасными1 для сервера, так как они только передают
информацию клиенту, а методы `POST`, `PUT` и `DELETE` — опасными, поскольку передают
информацию на сервер. Наибольшую угрозу представляют два последних метода, так как
они непосредственно указывают на объект на сервере. Используя эти методы, злоумышленник может атаковать сервер, заменяя
или удаляя некоторые его объекты.
В стартовой строке ответа, помимо уже упоминавшегося указания на версию протокола HTTP, имеется поле кода состояния и
поле фразы для короткого текстового сообщения,
поясняющего данный код пользователю. В настоящее время стандарты определяют пять
классов кодов состояния:

* `1xx` — информация о процессе передачи;
* `2xx` — информация об успешном принятии и обработке запроса клиента (в таблице в примере стартовой строки ответа
  приведен код и соответствующая фраза 200 OK, сообщающий клиенту, что его запрос успешно обработан);
* `3xx` — информация о том, что для успешного выполнения операции нужно произвести
  следующий запрос по другому URL-адресу, указанному в дополнительном заголовке
  Location;
* `4xx` — информация об ошибках со стороны клиента (читатель наверняка не раз сталкивался с ситуацией, когда при
  указании
  адреса несуществующей страницы браузер
  выводил на экран сообщение 404 Not Found);
* `5xx` — информация о неуспешном выполнении операции по вине сервера (например,
  сообщение 505 http Version Not Supported говорит о том, что сервер не поддерживает
  версию HTTP, предложенную клиентом).

Среди кодов состояния имеется код 401, сопровождаемый сообщением authorization
required. Если клиент получает такое сообщение в ответ на попытку доступа к странице
или объекту, это означает, что доступ к данному ресурсу ограничен и требует авторизации
пользователя.

### Cookie

**Куки (cookies — печенье)** представляет собой небольшой фрагмент текстовых данных, которым обмениваются веб-сервер и
браузер. Куки,
относящийся к некоторому сеансу браузера с сервером, содержит информацию о текущем
состоянии этого сеанса, аутентификационные данные и персональные настройки клиента,
а также уникальный для сервера номер сеанса. В течение всего сеанса куки сохраняется
_на стороне браузера._ При установлении соединения сервер генерирует содержимое куки
и передает его браузеру. Веб-браузер, получив текст куки от веб-сервера, сохраняет его
в виде файла. В течение всего сеанса пользователя, а возможно, и при всех повторных обращениях данного пользователя к
данному сайту, браузер передает куки серверу в том же
виде, в каком он его получил в последнем ответе сервера. Тем самым достигается эффект
запоминания состояния сеанса, причем состояние запоминается на стороне клиента.

Веб-сервер обычно применяет данные куки пользователя для его же (пользователя) удобства, например, интернет-магазины
обычно хранят в куки карту покупок пользователя,
в них также может храниться история навигации пользователя по страницам сайта. Типичной информацией, помещаемой
веб-сервером в куки, является идентификатор сеанса
пользователя (SID), на основе которого связываются воедино отдельные запросы пользователя. Даже в случае работы по
протоколу HTTP 1.1, который поддерживает длительные
TCP-сеансы, эти сеансы могут прерываться из-за временной неактивности пользователя,
так что объединение отдельных фрагментов сеанса (с тем, чтобы он представлялся пользователю единым) полезно для
индивидуального обслуживания пользователя.

Куки бывают _постоянными_ — они хранятся в файловой системе ОС и имеют длительные
сроки действия — и _временными_ — их браузер хранит в оперативной памяти и удаляет
после своего закрытия.

Куки имеют не только срок, но и _область действия_ — она задается доменным именем сайта,
который создал куки. Браузер не передает куки сайту с другим доменным именем, но так
как доменное имя может быть задано не для конкретного сайта, а для некоторого домена, то
есть, например, не для www.cisco.com, а для cisco.com, то куки могут иметь более широкую
область действия, чем один сайт.

## Протоколы TLS, SSL

Определение

* SSL (Secure Sockets Layer): Протокол, разработанный компанией Netscape Communications для защиты данных, передаваемых
  между клиентом (например, браузером) и сервером. SSL использует технологии, такие как шифрование, аутентификация и
  контроль целостности данных, обеспечивая защищенный канал связи.
* TLS (Transport Layer Security): Преемник SSL. Этот протокол был разработан как более безопасная альтернатива SSL, с
  улучшенными алгоритмами шифрования и новыми функциями. TLS обеспечивает защищенные соединения на уровне представления
  данных.

Основные функции протоколов

1. Взаимная аутентификация:

* Осуществляется путем обмена сертификатами, соответствующими стандарту X.509.
* Позволяет убедиться в подлинности обоих участников соединения.

2. Контроль целостности:

* Используются дайджесты для проверки, что данные не были изменены в процессе передачи.

3. Шифрование данных:

* Для обеспечения конфиденциальности используются симметричные ключи, которые генерируются на этапе “рукопожатия” и
  используются для шифрования всего последующего трафика.

Отличия TLS от SSL

1. Уровень безопасности:

* TLS использует более современные алгоритмы шифрования, такие как AES, а также улучшенные методы установления
  соединения (например, Elliptic Curve Cryptography).
* SSL, особенно версии 2.0 и 3.0, содержит уязвимости (например, атака POODLE), из-за чего эти версии больше не
  используются.

2. Эффективность:

* TLS более оптимизирован для работы с современными сетевыми протоколами, что снижает нагрузку на систему при
  установлении защищенного соединения.

3. Совместимость:

* TLS обратно совместим с SSL, но использование SSL в современных системах крайне нежелательно.

Применение

* Протоколы используются в HTTPS-соединениях, где HTTP работает поверх SSL или TLS. Например, при вводе
  адреса https://example.com браузер устанавливает защищенный канал связи с сервером, используя TLS.
* Протокол также может быть применен в других областях, таких как электронная почта (SMTP over TLS), VPN и файлообменные
  сервисы.

Заключение

SSL и TLS обеспечивают защиту данных, передаваемых через сеть. На сегодняшний день SSL заменен более безопасным
протоколом TLS. Современные системы должны использовать версии TLS 1.2 и 1.3 для обеспечения максимальной безопасности.

## Протокол FTP

### Определение

`FTP (File Transfer Protocol)` — это протокол прикладного уровня модели TCP/IP, предназначенный для передачи файлов
между клиентом и сервером в
сети. Он используется для доступа, передачи и управления файлами на удаленных системах, поддерживающих этот протокол.

### Как работает FTP

FTP функционирует по клиент-серверной модели. Клиент инициирует соединение и отправляет запросы, а сервер отвечает на
них. FTP использует два соединения:

1. Управляющее соединение: для передачи команд и статусов.
2. Данные: для передачи файлов.

### Заголовок протокола FTP

FTP, как протокол прикладного уровня, не имеет собственного заголовка в привычном понимании, так как он опирается на
функции транспортного уровня (TCP). Однако, структура взаимодействия включает:

1. Команды:
    * Текстовые команды, такие как USER, PASS, LIST, RETR, STOR.
    * Эти команды отправляются по управляющему каналу.
2. Коды ответа:
    * Сервер возвращает трехзначные коды ответа для обозначения состояния. Пример:
    * 200: успешное выполнение команды.
    * 530: отказ в доступе (требуется аутентификация).
    * 150: открытие соединения для передачи данных.
3. Формат передачи данных:
    * Данные передаются как потоки байтов, упакованные в TCP-сегменты.

### Пример работы FTP

1. Клиент вводит команду: ftp unix.mgu.com.
2. Клиент соединяется с сервером и передает команды:
    * `USER username` для передачи имени пользователя.
    * `PASS password` для ввода пароля.
3. После успешной аутентификации клиент использует команды:
    * `LIST:` просмотр содержимого директории.
    * `RETR filename`: скачивание файла.
    * `STOR filename`: загрузка файла на сервер.

### Применение FTP

FTP используется для:

* Загрузки и выгрузки файлов на серверы.
* Обмена большими объемами данных.
* Управления файлами на удаленных хостах.

### Современные аспекты

* `FTP` передает данные в открытом виде, что делает его небезопасным для использования в публичных сетях. Для защиты
  применяются:
* `FTPS (FTP Secure):` добавление SSL/TLS для шифрования.
* `SFTP (SSH File Transfer Protocol):` использование SSH для обеспечения безопасности передачи.

FTP остается важным инструментом в управлении данными и серверными операциями, особенно в частных сетях. Однако его
использование в открытых сетях требует дополнительного уровня защиты.

## Почтовая служба, протоколы POP и IMAP

### Почтовая служба

> **Сетевая почтовая служба**, или **электронная почта**, — это распределенное приложение, главной функцией которого
> является
> предоставление пользователям сети возможности обмениваться
> электронными сообщениями.

Как и все сетевые службы, электронная почта построена в архитектуре клиент-сервер. Почтовый клиент всегда располагается
на компьютере пользователя, а почтовый сервер, как правило, работает на выделенном компьютере.

**Почтовый клиент** (называемый также **агентом пользователя**) — это программа, предназначенная для поддержания
пользовательского интерфейса (обычно графического), а также для предоставления пользователю широкого набора услуг по
подготовке электронных сообщений. В число таких услуг входит создание текста в различных форматах и кодировках,
сохранение, уничтожение, переадресация, сортировка писем по разным критериям, просмотр перечня поступивших и
отправленных писем, грамматическая и синтаксическая проверка текста сообщений, ведение адресных баз данных, автоответы,
образование групп рассылки и прочее, и прочее. Кроме того, почтовый клиент поддерживает взаимодействие с серверной
частью почтовой службы.

**Почтовый сервер** выполняет прием сообщений от клиентов, для чего постоянно находится в активном состоянии. Кроме
того, он
выполняет буферизацию сообщений, распределение поступивших сообщений по индивидуальным буферам (почтовым ящикам)
клиентов, управляет объемами памяти, выделяемой клиентам, выполняет регистрацию клиентов и регламентирует их права
доступа к сообщениям, а также решает много других задач.

### Протокол SMTP

В качестве средств передачи сообщения почтовая служба Интернета использует стандартный, разработанный специально для
почтовых систем протокол `SMTP` (Simple Mail Transfer Protocol — простой протокол передачи почты).

Как и большинство других протоколов прикладного уровня, SMTP реализуется несимметричными взаимодействующими частями:
SMTP-клиентом, работающим на стороне отправителя, и SMTP-сервером, работающим на стороне получателя. SMTP-сервер должен
постоянно быть в режиме подключения, ожидая запросов со стороны SMTP-клиента. Логика протокола SMTP является
действительно достаточно простой, как это и следует из его названия:

1. После того как, применяя графический интерфейс своего почтового клиента, пользователь щелкает на значке отправки
   сообщения, SMTP-клиент посылает запрос на установление TCP-соединения на порт 25 SMTP-сервера (это назначенный порт).

2. Если сервер готов, то он посылает свои идентификационные данные, в частности свое DNS-имя. Если SMTP-сервер оказался
   не готов, то он посылает соответствующее сообщение клиенту, и тот снова посылает запрос, пытаясь заново установить
   соединение. Затем клиент передает серверу почтовые адреса (имена) отправителя и получателя. Если имя получателя
   соответствует ожидаемому, то после получения адресов сервер дает согласие на установление SMTP-соединения, и в рамках
   этого логического канала происходит передача сообщения.
3. Если после приема тела сообщения сервер отвечает командой OK, это означает, что сервер принял на себя ответственность
   по дальнейшей передаче сообщения получателю. Однако это не означает, что сервер гарантирует успешную доставку, потому
   что последнее зависит не только от него: например, клиентская машина получателя может быть в течение длительного
   времени не подсоединена к Интернету. Если сервер не может доставить сообщение, то он передает отчет об ошибке
   отправителю сообщения и разрывает соединение.

Нужно отметить, что в протоколе SMTP предусмотрены как положительные, так и отрицательные уведомления о доставке (
промежуточной или окончательной) электронного письма. Однако только отрицательные уведомления являются обязательными,
поэтому обычно SMTP-серверы предпочитают не передавать положительные уведомления в направлении отправителя.

> ### ПРИМЕЧАНИЕ
> Хотя в любом протоколе предполагается обмен данными между взаимодействующими частями,
> то есть данные передаются в обе стороны, различают протоколы, ориентированные на передачу
(push protocols), и протоколы, ориентированные на прием данных (pull protocols). В протоколах,
> ориентированных на передачу, к которым, в частности, относится протокол SMTP, клиент является
> инициатором передачи данных на сервер, а в протоколах, ориентированных на прием, к которым
> относятся, например, протоколы HTTP, POP3 и IMAP, клиент является инициатором получения
> данных от сервера.

### Схемы работы протокола SMTP

### 1. Схема с выделенным почтовым сервером

В этой схеме используется один почтовый сервер для отправки и приема электронной почты. Все взаимодействия между
отправителем и получателем осуществляются через этот сервер.

Процесс передачи сообщения:

1. Клиент отправляет сообщение на сервер отправки (SMTP-клиент):

* Отправитель (почтовый клиент) подключается к почтовому серверу через SMTP.
* Сообщение передается с информацией об отправителе, получателе и теле сообщения.

2. Почтовый сервер отправляет сообщение конечному серверу получателя:

* Почтовый сервер анализирует адрес получателя.
* Если получатель находится в другой доменной зоне, сервер инициирует соединение с сервером получателя.

3. Доставка сообщения на сервер получателя:

* Сервер отправляет сообщение конечному серверу (SMTP-сервер получателя).
* Сообщение сохраняется в почтовом ящике получателя.

4. Получатель получает сообщение через POP3 или IMAP:

* Пользовательский агент на стороне получателя загружает сообщение с сервера через протокол POP3 или IMAP.

Преимущества:

* Простота управления.
* Отсутствие промежуточных узлов снижает вероятность ошибок.

Недостатки:

* Уязвимость к перегрузке: если сервер занят или недоступен, отправка/получение сообщений откладывается.

### 2. Схема с двумя почтовыми серверами-посредниками

В этой схеме для доставки сообщений используется несколько промежуточных серверов. Каждый сервер действует как
SMTP-клиент и сервер одновременно, пересылая сообщение следующему узлу.

Процесс передачи сообщения:

1. Клиент отправляет сообщение своему почтовому серверу:

* Отправитель передает письмо через SMTP на сервер отправки (SMTP-клиент).

2. Первый сервер отправляет сообщение промежуточному серверу:

* Сервер анализирует адрес получателя.
* Если сервер не может доставить сообщение напрямую, оно пересылается на промежуточный сервер.

3. Промежуточный сервер пересылает сообщение серверу получателя:

* Промежуточный сервер передает сообщение далее, пока оно не достигнет конечного сервера получателя.

4. Доставка сообщения в почтовый ящик получателя:

* Конечный сервер сохраняет сообщение в почтовом ящике.
* Пользователь получает сообщение через POP3 или IMAP.

Преимущества:

* Повышенная надежность: если один сервер недоступен, сообщение может быть переслано через другой маршрут.
* Гибкость маршрутизации: позволяет оптимизировать доставку в сложных сетях.

Недостатки:

* Увеличение времени доставки из-за прохождения через несколько узлов.
* Увеличение риска утечки данных на промежуточных серверах (при отсутствии шифрования).

Пример работы в реальной жизни

* Схема с выделенным сервером используется в небольших организациях или для персональной почты.
* Схема с двумя серверами применяется в крупных корпорациях или провайдерах электронной почты, где существуют сложные
  маршруты доставки сообщений.

SMTP остается основным стандартом для передачи электронной почты, и выбор схемы зависит от размеров инфраструктуры и
требований к надежности и безопасности.

## Протокол DNS

> Доменная служба имен (Domain Name Service, DNS) отображает символьные имена узлов сети
> на их IP-адреса (как IPv4, так и IPv6). Доменная служба имен является важной частью Интернета,
> но она может работать и в любой автономной IP-сети.

![Пространство доменных имён](img/img_10.png)
Пространство доменных имён

Как и в файловой системе, в доменной системе имен различают краткие, относительные
и полные доменные имена.

* Краткое доменное имя — это имя конечного узла сети: хоста
  или порта маршрутизатора. Краткое имя — это лист дерева имен.
* Относительное доменное имя — это составное имя, начинающееся с некоторого уровня иерархии, но не самого
  верхнего. Например, www.zil — это относительное имя.
* Полное доменное имя включает составляющие всех уровней иерархии, начиная от краткого имени и кончая корневой
  точкой: www.zil.mmt.ru. Если в каждом
  домене и поддомене обеспечивается уникальность имен
  следующего уровня иерархии, то и вся система имен будет состоять из уникальных имен.

`Корневой домен имен` управляется центральными органами Интернета, в частности, такой
организацией, как ICANN.

`Домены верхнего уровня` назначаются для каждой страны, а также для различных типов
организаций. Для обозначения стран используются трехбуквенные и двухбуквенные аббревиатуры, например, ru (Россия), uk (
Великобритания), fi (Финляндия), us (Соединенные
Штаты), а для различных типов организаций, например, следующие обозначения:

* com — коммерческие организации (например, microsoft.com);

* edu — образовательные организации (например, mit.edu);

* gov — правительственные организации (например, nsf.gov);

* org — некоммерческие организации (например, fidonet.org);

* net — сетевые организации (например, nsf.net).

Каждый домен администрирует отдельная организация, которая обычно разбивает свой
домен на поддомены и передает функции администрирования этих поддоменов другим
организациям.

### Сервер, клиент и протокол DNS

Как и всякая сетевая служба, система DNS состоит из серверов и клиентов. `DNS-серверы`
поддерживают распределенную базу отображений, а `DNS-клиенты` обращаются к серверам
с запросами об отображении доменного имени на IP-адрес (эту процедуру называют также
_«разрешением»_ доменного имени).

DNS-клиентом является практически каждый узел Интернета, будь то клиентский компьютер, сервер приложений или
маршрутизатор. Программа, реализующая функции клиента
DNS, называется **резольвером**, обычно она входит в состав ОС. Резольверу должен быть известен IP-адрес, по крайней
мере одного DNS-сервера, этот адрес конфигурируется вручную
или же получается по протоколу DHCP, о котором мы будем говорить в следующем разделе.

Подавляющее большинство DNS-серверов использует программное обеспечение `BIND
(Berkeley Internet Name Domain)`, разработанное в Калифорнийском университете Беркли.

Сервер и клиент службы DNS взаимодействуют по **протоколу DNS.** Сообщения этого протокола чаще всего передаются в
_дейтаграммах_ UDP c портом сервера 53, но в некоторых
случаях, требующих повышенной надежности, служба DNS обращается к услугам TCP.

### Иерархическая организация службы DNS

Иерархию образуют DNS-серверы. На самой вершине иерархии располагаются `корневые
серверы`. Корневые серверы хранят текстовые файлы имен и IP адресов DNS- серверов
следующего уровня, называемого верхним (top level DNS, tlDNS или TLD). Серверы верхнего уровня хранят данные об именах и
адресах имен, входящих в домены верхнего уровня
(com, ru или fm), а также об именах серверов DNS, которые обслуживают домены второго
уровня иерархии (cisco.com, yandex.ru и т. п.).

Пространство доменных имен «разрезают» между серверами DNS, обычно так,
чтобы сервер DNS хранил записи только в пределах одного уровня, а для имен своих
поддоменов хранил только ссылки на серверы DNS, которые отвечают за эти поддомены.

> Часть пространства доменных имен, для которых некоторый сервер DNS имеет информацию об
> их отображениях на основе соответствующего текстового файла, называется зоной DNS данного
> сервера, а сам текстовый файл — файлом зоны.


Когда сервер DNS дает ответ о записи, входящей в зону, за которую он отвечает, такой ответ называется полномочным
ответом DNS (authoritative, что можно также перевести как
официальный, авторитетный или аутентичный). Как мы увидим далее, сервер DNS может
также давать неполномочный ответ, если запрос относится не к его зоне, но он знает ответ
на него за счет кэширования ответов других серверов.
Файл зоны состоит из текстовых записей нескольких типов:

* _запись типа А_ — отображает имя в IPv4-адрес;
* _запись типа AAAA_ — отображает имя в IPv6-адрес;
* _запись типа NS_ — определяет имя DNS-сервера для некоторого домена;
* _запись типа MS_ — определяет имя почтового сервера для некоторого домена,
  а также некоторых других.

Протокол DNS позволяет клиенту делать запросы относительно некоторого доменного
имени, задавая тип записи или же запрашивая все типы, относящиеся к данному имени. В системе DNS поддерживает не только
отображение типа «один-к-одному», но и отображения
«многие-к-одному» и «один-ко-многим». То сеть хост может иметь, кроме одного основного
доменного имени, несколько так называемых псевдонимов (alias). Такое свойство оказывается

Отображение «один-ко-многим» используется для распараллеливания нагрузки на веб-серверы, которые испытывают
перегрузку от наплыва запросов. Для этого перегруженный
сервер заменяют несколькими функционально подобными серверами. В файле зоны DNS
создается запись, в которой доменному имени данного веб-сервера ставится в соответствие
набор IP-адресов дублирующих серверов. В ответе на каждый запрос DNS-сервер посылает
весь набор IP-адресов, предварительно сдвинув его на одну позицию, поэтому нагрузка распределяется между всеми
дублирующими серверами. Для обеспечения надежности и высокой производительности для каждой зоны существует один
`первичный (primary) сервер
DNS` и несколько `вторичных (secondary) серверов DNS`. На первичном сервере находится
исходный файл зоны — _мастер-копия файла зоны_, которая редактируется администратором
сервера; вторичные серверы периодически копируют файл зоны с первичного сервера, для
этого может использоваться протокол DNS, в котором имеется соответствующий тип за-
проса, или же администратор может использовать любой протокол копирования файлов,
например, ftp или scp. Если файл зоны передается по протоколу DNS, то для повышения
надежности используется _протокол_ TCP (порт 53).

## Протоколы IPv5 и IPv6. Стркуктрура даресов IPv6

### Отличие от IPv4

Система адресации IPv6 внесла существенные изменения в прежнюю систему. Прежде всего
увеличилась разрядность адреса: вместо _4 байт_ IP-адреса в версии IPv4 в новой версии под
адрес отведено _16 байт._

> Главной целью изменения системы адресации было не механическое увеличение адресного пространства, а повышение
> эффективности работы стека TCP/IP в целом.

В новой версии не поддерживаются классы адресов (A, B, C, D, E), но широко используется технология CIDR. Благодаря
этому, а также усовершенствованной системе групповой
адресации и введению адресов нового типа IPv6 может сократить затраты на маршрутизацию.

Важным усовершенствованием в системе адресации IPv6 стало введение для каждого адреса признака `области
действия адресов (scope)`, определяющего ту часть сети, в пределах которой этот адрес является действительным и
уникальным. Так, пакет с адресом уровня линии связи1 (Link-local) может использоваться в коммуникациях
смежных узлов, но будет отвергнут первым же маршрутизатором на пути в другой сегмент сети, так как область действия
этого адреса ограничена линией связи. Поскольку признак scope определяет ту часть сети,
в которой тот или иной адрес должен быть уникальным, то один и тот же индивидуальный
адрес может использоваться разными хостами в разных частях сети.

Одним из наиболее полезных свойств технологии IPv6 является развитая способность сетевых устройств IPv6 к
`автоконфигурированию` даже при отсутствии DHCP-серверов. По умолчанию каждый хост IPv6 может при подключении к сети
автоматически
конфигурировать интерфейсы, основываясь на MAC-адресе своего сетевого адаптера
и информации, предоставляемой соседними маршрутизаторами.

### Типы адресов IPv6

В IPv6 предусмотрены три основных типа адресов (RFC 4291):

* `Индивидуальный адрес (unicast)`, как и в версии IPv4, является уникальным идентификатором отдельного интерфейса
  конечного узла или маршрутизатора. Существуют несколько типов индивидуальных адресов. Некоторые из них (site-local,
  IPv4-Compatible адреса) уже успели устареть и не рекомендуются к использованию в новых разработках, другие — как,
  например, глобальный индивидуальный адрес или адрес уровня линии связи (Link-Local unicast) — активно используются.
  Индивидуальные адреса делятся на:
    * `глобальные индивидуальные адреса (global unicast)`, предназначенные для использования в Интернете; область
      действия этих адресов не ограничена;
    * `индивидуальные адреса уровня линии связи (link-local unicast)`, называемые также
      локальными адресами или адресами уровня подсети, предназначены для локального
      использования; область действия этих адресов ограничена соответствующей линией
      связи.
* `Групповой адрес (multicast)` аналогичен по назначению групповому адресу IPv4 — он
  идентифицирует группу интерфейсов, относящихся, как правило, к разным узлам.
  Пакет с таким адресом доставляется всем интерфейсам, имеющим аналогичный адрес.
  Групповые адреса в некоторых случаях выполняют функцию отсутствующих в IPv6
  широковещательных адресов.
* `Адрес произвольной рассылки (anycast)`, как и групповой адрес, определяет группу
  интерфейсов, но, в отличие от группового адреса, пакет, в поле адреса назначения
  которого стоит адрес произвольной рассылки, доставляется одному из интерфейсов
  группы, как правило, «ближайшему» в соответствии с метрикой, используемой протоколами маршрутизации. Синтаксически
  адрес произвольной рассылки ничем не
  отличается от индивидуального адреса — он назначается из того же диапазона адресов,
  что и индивидуальные адреса. Адрес произвольной рассылки может быть назначен
  только интерфейсам маршрутизатора. Интерфейсы маршрутизаторов, входящие в одну
  группу адресов произвольной рассылки, имеют помимо индивидуальных адресов еще
  и общий для всех них адрес произвольной рассылки. Адреса такого типа ориентированы
  на маршрутизацию от источника, когда маршрут прохождения пакета определяется
  узлом-отправителем путем указания в поле параметров пакета IP-адресов всех промежуточных маршрутизаторов.
  В IPv6 так же, как в IPv4, определены _особые адреса:_
    * `Неопределенный адрес (unspecified address)` 0:0:0:0:0:0:0:0 никогда не назначается и обозначает отсутствие
      адреса.
      Например, все пакеты, посылаемые хостом, который находится
      в состоянии инициализации и еще не имеет адреса, содержат в поле адреса источника
      неопределенный адрес — 128 нулей. Неопределенный адрес не может быть использован
      в качестве адреса назначения.

    * `Адрес обратной петли (loopback address)` 0:0:0:0:0:0:0:1 в IPv6 используется узлом для
      того, чтобы посылать пакеты самому себе. Пакеты с адресом обратной петли в поле адреса
      источника или адреса назначения отбрасываются маршрутизаторами.

Тип адреса определяется значением нескольких старших битов адреса, которые называются
`префиксом формата (FP).`

| Тип адреса                      | Двоичная запись префикса формата | Запись префикса в формате IPv6 |
|---------------------------------|----------------------------------|--------------------------------|
| Неопределённый                  | 00...0 (128 бит)                 | `::/128`                       |
| Адрес обратной петли            | 00...1 (128 бит)                 | `::1/128`                      |
| Групповой адрес                 | 11111111                         | `FF00::/8`                     |
| Адрес уровня линии связи        | 1111111010                       | `FE80::/10`                    |
| Глобальный индивидуальный адрес | Все остальные значения           |                                |

## **Индивидуальные адреса (Unicast)**

Индивидуальный адрес — это уникальный идентификатор отдельного интерфейса в сети. Пакеты, отправляемые на индивидуальный
адрес, доставляются только к одному конкретному узлу.

### **Типы индивидуальных адресов:**

1. **Глобальный индивидуальный адрес (Global Unicast)**:
    - Это основной тип индивидуального адреса, который используется для взаимодействия в Интернете.
    - Поддерживает маршрутизацию на глобальном уровне.
    - **Структура**:
        1. **Глобальный префикс маршрутизации** (первые 45 бит):
            - Назначается интернет-провайдером или организацией.
            - Идентифицирует сети, которые могут быть маршрутизированы глобально.
        2. **Идентификатор подсети** (следующие 16 бит):
            - Используется для разделения большой сети на подсети внутри организации.
        3. **Идентификатор интерфейса** (последние 64 бита):
            - Уникально идентифицирует устройство в рамках подсети.
            - Генерируется автоматически или задается вручную.
    - **Пример**: `2001:db8::/32`.

    - **Особенности**:
        - Эти адреса сопоставимы с публичными IP-адресами IPv4.
        - Требуют ручного или автоматизированного управления через DHCPv6 или SLAAC (Stateless Address
          Autoconfiguration).

---

2. **Адрес уровня линии связи (Link-Local Unicast)**:
    - Назначается автоматически всем интерфейсам IPv6.
    - Используется для связи внутри одной линии связи (например, в пределах локальной сети).
    - **Структура**:
        - Префикс: `FE80::/10`.
        - Остальная часть адреса формируется на основе MAC-адреса устройства с использованием схемы EUI-64.
    - **Применение**:
        - Используется для обнаружения соседей (протокол NDP).
        - Незаменим при настройке маршрутизации, так как маршрутизаторы взаимодействуют через эти адреса.
    - **Пример**: `FE80::1a2b:3c4d:5e6f:7g8h`.

---

3. **Уникальные локальные адреса (Unique Local Address, ULA)**:
    - Аналог частных адресов IPv4 (например, `192.168.x.x`).
    - Используются для связи внутри организации или группы сетей.
    - Не маршрутизируются в Интернете.
    - **Структура**:
        - Префикс: `FC00::/7`.
        - Разделяется на два диапазона:
            - `FC00::/8` — резерв для централизованного назначения (не используется).
            - `FD00::/8` — для локального использования.
    - **Пример**: `FD12:3456:789a::/48`.

---

## **Групповые адреса (Multicast)**

Групповые адреса предназначены для передачи пакетов сразу нескольким узлам, входящим в определенную группу. Это улучшает
производительность сети, так как один пакет может быть доставлен нескольким узлам без необходимости отправки его каждому
узлу отдельно.

### **Основные особенности групповых адресов:**

1. **Префикс**:
    - Все групповые адреса начинаются с `FF00::/8`.

2. **Область действия (Scope)**:
    - Определяет, в какой области действует групповой адрес:
        - `1`: ограничение одним интерфейсом.
        - `2`: ограничение линией связи (Link-Local).
        - `5`: ограничение на уровне сайта.
        - `8`: внутри организации.
        - `E`: глобальная область действия.
    - Пример: адрес `FF02::1` имеет локальную область действия на уровне линии связи.

3. **Функциональные группы**:
    - Существует ряд стандартных групп, например:
        - `FF02::1`: все узлы линии связи.
        - `FF02::2`: все маршрутизаторы линии связи.
        - `FF05::2`: все маршрутизаторы на уровне сайта.
    - Узлы могут динамически входить в группы и покидать их.

### **Применение групповых адресов**:

1. **Распределение мультимедиа**:
    - Используются для передачи потокового видео и аудио, где требуется передача одного потока на множество узлов.

2. **Протоколы обнаружения и управления**:
    - Используются в NDP (Neighbor Discovery Protocol) для взаимодействия с соседними узлами.
    - Важны для реализации автоматической настройки сетей IPv6.

3. **Балансировка нагрузки**:
    - Узлы, входящие в одну группу, могут совместно обрабатывать запросы, тем самым снижая нагрузку на отдельные
      серверы.

## **Сравнение индивидуальных и групповых адресов**

| Параметр            | Индивидуальные адреса (Unicast)     | Групповые адреса (Multicast)           |
|---------------------|-------------------------------------|----------------------------------------|
| Назначение          | Передача пакета одному узлу         | Передача пакета группе узлов           |
| Префиксы            | `2000::/3`, `FE80::/10`, `FC00::/7` | `FF00::/8`                             |
| Основное применение | Связь между конкретными узлами      | Распределение данных множеству узлов   |
| Область действия    | Локальная, глобальная               | Локальная, организационная, глобальная |

## **Заключение**

- **Индивидуальные адреса** предназначены для одноадресной связи. Они включают глобальные, локальные и уникальные
  локальные адреса, охватывающие практически все потребности в адресации.
- **Групповые адреса** обеспечивают эффективное использование сети для передачи данных множеству получателей, особенно в
  приложениях, требующих рассылки большого объема данных.

IPv6 делает сетевую архитектуру гибкой, улучшая производительность, масштабируемость и поддержку современных приложений.

## Формат пакета IPv6

Одной из основных целей изменения формата заголовка протокола IPv6 было сокращение
накладных расходов, то есть уменьшение объема служебной информации, передаваемой
с каждым пакетом. Для этого в новом протоколе IP были введены понятия _основного_ и _дополнительных_ заголовков.

![Структура пакета IPv6](img/img_11.png)

Каждый заголовок в этой последовательности
указывает на то, какой именно заголовок должен идти следующим, поместив в своем поле
`next heade`r код, закрепленный за данным типом заголовка. Так, код 0 в основном заголовке
указывает на то, что за ним должен следовать заголовок транзитных опций, а код 60 в заголовке транзитных опций указывает
на заголовок опций узла назначения.

### Основной заголовок

Основной заголовок имеет фиксированную длину в 40 байт и включает следующие поля:

![Структура основного заголовка IPv6](img/img_12.png)

* Поле `версия протокола (version)` занимает 4 бита и равно номеру версии — 6.

* `Класс трафика (traffic class)` занимает 8 бит. Это поле аналогично полю «Тип сервиса» в IPv4 и может быть
  использовано
  для разбиения трафика на небольшое количество
  агрегированных классов обслуживания с различным уровнем QoS.
* `Метка потока (flow label, 20 бит)` указывает на принадлежность пакета к тому или иному потоку. Поле «Метка потока»,
  _отсутствующее_ в протоколе IPv4, позволяет
  выделить из общего трафика индивидуальные потоки и обслуживать их отличным от
  других пакетов способом. Отличие может заключаться в обеспечении индивидуального
  уровня QoS или же в индивидуальном маршруте потока. В узле-источнике всем пакетам
  потока, для которого требуется особое обслуживание,
* `Длина поля данных (payload length, 16 бит).` Число, которое содержится в этом поле, определяет количество байтов,
  занимаемое всеми дополнительными заголовками и протокольной
  единицей данных вышележащего уровня. Максимальное значение этого поля равно 65 535.
  IPv6 допускает существование пакетов с более длинным полем данных, так называемых
  сверхбольших дейтаграмм, или _джамбограмм_ (jumbograms). В этом случае для задания
  длины используется 32-двухразрядное поле одной из опций дополнительного заголовка
  транзитных опций hop-by-hop.
* `Следующий заголовок (next header, 8 бит).` Это поле соответствует по назначению полю
  «протокол верхнего уровня» в версии IPv4 и содержит код, определяющий тип заголовка,
  который следует за текущим. Каждый следующий дополнительный заголовок также содержит поле следующего заголовка. Если
  IPv6-пакет не содержит дополнительных заголовков, то в этом поле будет значение, закрепленное за протоколом TCP, UDP,
  RIP, OSPF
  или другим, определенным в стандарте IPv4.
* `Предельное число шагов (hop limit, 8 бит).` Это поле за небольшим исключением аналогично
  полю времени жизни TTL протокола IPv4: при прохождении каждого маршрутизатора из
  значения этого поля вычитается единица. Когда оно становится равным 0, маршрутизатор
  отбрасывает пакет и посылает ICMP-сообщение о превышении предельного числа шагов.
  Максимальное значение поля равно 255.
* Поля `адреса источника` и `адреса назначения`занимают по 128 бит.

### Дополнительные заголовки

В стандартах протокола IPv6 фигурируют следующие типы **дополнительных заголовков:**

* `заголовок транзитных опций (hop-by-hop options)` — параметры, используемые при обработке пакетов маршрутизаторами;
* `заголовок опций места назначения (destination option)` — дополнительная информация для промежуточных или финального
  узлов назначения;
* `заголовок маршрутизации (routing)` содержит в поле данных последовательность IPv6-адресов всех промежуточных узлов,
  которые должен пройти пакет на пути от источника
  до места назначения; такой способ задания маршрута называют маршрутизацией от
  источника;
* `заголовок фрагментации (fragment)` — информация, относящаяся к фрагментации IP- пакета (поле обрабатывается только в
  конечных узлах);
* `заголовок аутентификации (authentication)` — информация, необходимая для аутентификации конечных узлов и обеспечения
  целостности содержимого IP-пакетов;
* `заголовок поля безопасных вложений (encapsulating security payload)` — информация, необходимая для обеспечения
  конфиденциальности передаваемых данных путем шифрования и дешифрирования.

> Дополнительные заголовки могут иметь
> как переменную длину (заголовки транзитных опций и опций места назначения), так
> и фиксированную длину (все остальные заголовки).

Как заголовок транзитных опций, так и заголовок опций места назначения может включать переменное число информационных
структур — **опций**, обрабатываемых в порядке
их следования в заголовке. Каждая опция состоит из трех полей:

* `Тип опции` состоит из 8-битового кода, который, помимо указания на собственно тип опции, говорит маршрутизатору,
  может
  ли в результате обработки этой опции измениться маршрут следования данного пакета, а также что он должен сделать с
  пакетом, если не распознает тип опции: пропустить опцию, отбросить пакет или отбросить пакет и послать ICMP-сообщение.
  *` Длина поля данных опции (8 бит)`, которая содержит число, указывающее длину опции в байтах без учета длины первых
  двух
  полей.
* `Данные опции` — поле переменной длины, содержащее информацию, специфичную для конкретного типа опции.

Формат заголовка транзитных опций:
![Формат заголовка транзитных опций](img/img_13.png)

## Архитектура безпроводных сетей

`Беспроводные локальные сети (Wireless Local Area Network, WLAN)` в некоторых случаях являются предпочтительным по
сравнению с проводными сетями решением, а иногда
и единственно возможным. В WLAN сигнал распространяется с помощью электромагнитных волн высокой частоты. Современные
беспроводные локальные сети позволяют
передавать данные на скоростях до нескольких гигабит в секунду.

Преймущества:

- Беспроводные локальные сети проще и дешевле развертывать, так как нет необходимости в кабельной инфраструктуре.
- Легче модифицировать и расширять существующую сеть.
- Обеспечивают мобильность пользователей, позволяя подключаться к сети из разных мест без привязки к проводам.

Однако за эти преимущества беспроводные сети расплачиваются длинным перечнем проблем, которые несет с собой неустойчивая
и непредсказуемая беспроводная среда и, в частности, особенности распространения сигналов в такой среде.
Помехи от разнообразных бытовых приборов и других телекоммуникационных систем, атмосферные помехи и отражения сигнала
создают серьезные трудности для надежного приема информации.

Методы _расширения спектра_ помогают снизить влияние помех на полезный сигнал. Кроме того, в беспроводных сетях широко
используются _прямая коррекция ошибок (FEC)_ и протоколы с повторной передачей потерянных кадров.

Неравномерное распределение интенсивности сигнала приводит не только к битовым
ошибкам передаваемой информации, но и к _неопределенности зоны_ покрытия беспроводной локальной сети.

### Существующие проблемы

Проблема **скрытой станции** возникает, если два узла находятся в зоне досягаемости друг друга,
но существует третий узел, который принимает сигналы.

Когда один узел передает данные другому, третий узел, желающий начать передачу данных, может определить среду как
занятую, хотя на самом деле приемник доступен. Такая ситуация называется **проблемой засвеченного терминала.**

> Причиной того, что алгоритм доступа к проводной среде не работает в случае среды беспроводной, заключается в
> следующем. И в том и в другом случае узел-отправитель проверяет состояние
> среды на своем интерфейсе. Но если для проводной линии связи занятость на выходном интерфейсе передающего узла
> действительно означает занятость узла-получателя, то для беспроводной сети возможны разные комбинации состояний среды
> на
> выходном интерфейсе и интерфейсе
> узла-получателя: свободен—занят, занят—свободен, свободен—свободен и занят—занят.

Поэтому в сетях Wi-Fi применяется другой алгоритм доступа, основанный на методе простоя источника: узел, передавший
кадр, должен дождаться _подтверждения_
о его получении от узла получателя и только после этого посылать следующий кадр. Если
подтверждение не приходит в течение заданного интервала времени, то считается, что кадр
был потерян в результате коллизии, и узел передает копию этого кадра.

## Стек протоколов и стандарты IEEE 802.11

### IEEE 802.11

Сети и оборудование стандарта `IEEE 802.11`, также известные под названием `Wi-Fi (Wireless Fidelity)` — по
имени консорциума Wi-Fi Alliance, который занимается вопросам совместимости и сертификации оборудования стандартов IEEE
802.11, — занимают лидирующие позиции в мире
беспроводных локальных сетей.

Стандарт 802.11 определяет в качестве основного структурного элемента WLAN сеть
с **базовым набором услуг** (Basic Service Set, **BSS**). BSS представляет собой набор беспроводных сетевых устройств,
разделяющих среду передачи и работающих с одинаковыми характеристиками доступа к среде: частота и схема модуляции
сигналов.

Сети BSS могут быть объединены в группы, называемые сетями с **расширенным набором услуг
(Extended Service Set, ESS)**. ESS образуется путем соединения между собой нескольких
сетей BSS, расположенных в одном и том же сегменте логической сети (например, IP-подсеть, VLAN и т. д.).

Стандарт 802.11 различает два типа топологий сетей BSS:

* Топология на основе связей «точка-точка» (узлы взаимодействуют друг с другом непосредственно), сеть с такой топологией
  в стандарте 802.11 называют **независимой**
  (Independent BSS, IBSS) или сетью «по случаю» (**Ad-Hoc BSS**). Сеть Ad-Hoc BSS представляет собой набор узлов,
  взаимодействующих через общую
  электромагнитную среду на основе децентрализованного алгоритма доступа. Сеть Ad-
  Hoc создается самопроизвольным способом на некоторый (обычно небольшой) период
  времени. Хотя базовая станция в сети Ad-Hoc отсутствует, в каждый момент времени
  в сети имеется один или несколько узлов, которые берут на себя ведущую роль. Отметим,
  сети Ad-Hoc функционируют автономно, в них нет никаких средств для связи с другими
  сетями.
* Централизованная топология с использованием одного центрального узла. Центральный элемент называют
  **базовой станцией**, а
  соответствующие сети — **инфраструктурными сетями** (Infrastructure BSS, или просто **BSS**). Пользователи
  инфраструктурной BSS могут обмениваться информацией только с базовой
  станцией, а она транзитом обеспечивает взаимодействие между отдельными пользователями, то есть весь трафик в BSS
  проходит через базовую станцию. Инфраструктурная BSS
  образует широковещательный домен. Пользователи инфраструктурной BSS могут обмениваться информацией только с базовой
  станцией, а она транзитом обеспечивает взаимодействие между отдельными пользователями, то есть весь трафик в BSS
  проходит через базовую станцию. Инфраструктурная BSS
  образует широковещательный домен. Базовая станция обычно соединяется проводным сегментом Ethernet с проводной частью
  сети, обеспечивая доступ «своим» узлам к узлам других базовых станций или узлами других сетей, обычно к Интернету.
  Поэтому базовая станция также называется `точкой доступа`
  (Access Point, AP). Таким образом, точка доступа имеет два интерфейса — беспроводной
  и проводной сети. Точка доступа включает не только оборудование DCE, необходимое для
  образования линии связи, но и чаще всего является _коммутатором_ сети, доступ к которой она обеспечивает. Именно
  наличие дополнительного оборудования (инфраструктуры) — точки доступа, связанной
  проводной линией с маршрутизатором, — объясняет название «_инфраструктурные сети_»,
  в отличие от сетей Ad-Hoc, не обладающих никакой инфраструктурой. В сетях ESS точки
  доступа нескольких BSS связаны между собой с помощью **распределительной системы**, называемой в стандарте
  Distribution
  System (DS), в качестве которой может использоваться
  та же среда (то есть радио- или инфракрасные волны), что и среда взаимодействия между
  узлами, или же отличная от нее, например проводная.

![Топологии сетей BSS](img/img_14.png)

### Стек протоколов IEEE 802.11

Как можно было ожидать, стек протоколов стандарта IEEE 802.11 (рис. 22.5) соответствует
общей структуре стандартов комитета 802, то есть состоит из физического уровня и уровня MAC, поверх которых работает
уровень LLC. Как и у всех технологий семейства 802,
технология 802.11 определяется нижними двумя уровнями, то есть физическим уровнем
и уровнем MAC, а уровень LLC выполняет свои стандартные функции, общие для всех
технологий LAN.
![Стек протоколов IEEE 802.11](img/img_15.png)

Уровень MAC выполняет в беспроводных сетях больше функций, чем в проводных. Функции уровня MAC в стандарте 802.11
включают:

* доступ к разделяемой среде;
* обеспечение мобильности станций при наличии нескольких базовых станций;
* обеспечение безопасности, эквивалентной безопасности проводных локальных сетей.

### Стандарты физического уровня

Все варианты физического уровня работают с одним и тем же алгоритмом уровня MAC, но некоторые временные параметры уровня
MAC зависят от используемого
физического уровня.

**Общие свойства стандартов семейства IEEE 802.11:**

* Одна и та же топология.
* Все стандарты поддерживают в качестве рабочего диапазона частот либо 2,4 ГГц, либо
  5 ГГц, либо оба эти диапазона.
* Один и тот же способ доступа к разделяемой среде CSMA/CA — метод прослушивания несущей частоты с множественным
  доступом и предотвращением коллизий.
* Одинаковая структура кадра канального уровня.
* Все стандарты имеют адаптивный механизм изменения скорости передачи в зависимости от расстояния до приемника.
  Адаптация может происходить за счет изменения
  метода кодирования сигнала — например, для увеличения скорости передачи данных
  точка доступа может перейти от кодирования 16-QAM к кодированию 64-QAM.
  При использовании техники OFDM точка доступа может, наряду с изменением
  метода кодирования, увеличить количество частотных подканалов, выделяемых
  пользователю.

Узлы сети Wi-Fi, как и узлы локальной проводной сети, оснащены **сетевым адаптером**. Он
выполняет функции физического и канального уровней, отличаясь от сетевого адаптера
проводной сети наличием антенны.

## Формат кадра в стандарте IEEE 802.11

В отличие от Ethernet, имеющего кадр только одного типа — кадр данных, в технологии
**Wi-Fi** поддерживаются **кадры** нескольких типов, причем их структура гораздо сложнее.

![Формат кадра Wi-Fi](img/img_16.png)

Имеется три типа кадров Wi-Fi:

* кадры данных;
* кадры слоя управления;
* кадры слоя менеджмента.

Одной из особенностей кадра Wi-Fi является наличие в нем _четырех полей_ МАС-адресов.
Их назначение зависит от конфигурации сети. В том случае, когда две точки доступа непосредственно взаимодействуют друг с
другом, используются все четыре МАС-адреса:
станции-источника, двух точек доступа и станции назначения. Когда станция обменивается
данными с узлом Интернета, то используется только три адреса — станции пользователя,
точки доступа и маршрутизатора распределительной системы.

Искажение данных выявляется
по значению поля контрольной суммы, а потерянные кадры — по значению поля «_Управление последовательностью_», содержащем
порядковые номера кадров.

Поле данных в кадрах Wi-Fi может содержать до 2312 байт пользовательских данных. Кадры могут фрагментироваться, но цель
этой операции отличается от протокола IP. В IP фрагментация происходит, если пакет превышает MTU маршрутизатора, а в
Wi-Fi она используется для повышения надежности передачи в условиях помех.

Чем меньше кадр, тем выше вероятность его получения без искажений. Станция-отправитель ждет подтверждения (квитанции) на
каждый фрагмент, прежде чем отправить следующий. Если происходит искажение, повторно передается только поврежденный
фрагмент. В поле «Управление последовательностью» указаны номер кадра и номер фрагмента. Признак «Фрагмент» равен 1 для
всех фрагментов, кроме последнего (0).

Поле «Длительность» определяет время резервирования среды для передачи кадра:

- **При распределенном доступе**: значение равно времени ожидания квитанции, делая передачу неделимой — другие станции
  не могут вклиниться. Для фрагментов оно складывается из времени ожидания квитанции текущего фрагмента, передачи
  следующего и ожидания его подтверждения.
- **Для широковещательных кадров**: поле равно 0, так как квитанции не требуется.
- **При централизованном доступе**: значение фиксировано и равно 32768.

Дополнительные поля:

- **«Шифрация»**: 1 — данные зашифрованы.
- **«Еще данные»**: 1 — станция готовит данные для следующих кадров.
- **«Порядок»**: 1 — порядок кадров важен.
- **«К точке доступа» / «От точки доступа»**: показывают направление передачи.

Эти механизмы обеспечивают надежность, упрощают управление трафиком и защищают данные в беспроводной сети.

## Процедура присоединения устройств в IEEE 802.11

Для того чтобы работать с точкой доступа, станция пользователя должна выполнить _процедуру присоединения к сети_. В
процессе этой процедуры точка доступа может попросить
станцию пройти аутентификацию, чтобы исключить посторонних пользователей от использования данной сети.

Существуют два режима присоединения — _пассивный_ и _активный_.

* В первом режиме станция пассивно прослушивает радиоэфир и
  пытается на всех частотных каналах обнаружить
  кадры специального типа — так называемые `кадры-маячки (beacon frames)`. Эти кадры
  периодически, с интервалом 100 мс, посылает точка доступа, в них содержится ее МАС-
  адрес и идентификатор сети SSID.

* Активный режим отличается от пассивного тем, что
  станция сама посылает в радиосреду специальные кадры другого типа — `пробные кадры
(probe frames)`. Точка доступа, получив пробный кадр, отвечает на него, сообщая станции
  те же сведения о себе, что и в кадрах-маячках, то есть МАС-адрес и идентификатор SSID.

Когда сеть выбрана, станция посылает точке доступа кадр «Запрос на присоединение».
Затем точка доступа инициирует процедуру аутентификации, и, если она успешна, то
маршрутизатор распределенной системы, пользуясь протоколом DHCP, назначает станции
IP-адрес. Для адресов IPv4 маршрутизатор, скорее всего, выдаст частный IP-адрес, требующий применения техники трансляции
адресов NAT для доступа станций
сети к сети Интернет. Для адресов IPv6 адрес, скорее всего, будет выдан глобальный, так
что трансляция адресов не понадобится.

## Работа proxy и NAT

> **Прокси-сервер** (proxy server) — особый тип приложения, выполняющего функции посредника
> между клиентскими и серверными частями распределенных сетевых приложений, причем предполагается, что клиенты
> принадлежат внутренней (защищаемой) сети, а серверы — внешней
(потенциально опасной) сети. Роль транзитного узла позволяет прокси-серверу логически
> разорвать прямое соединение между клиентом и сервером с целью контроля процесса обмена
> сообщениями между ними.

Подобно файерволу, прокси-сервер может эффективно выполнять свои функции только
при условии, что контролируемый им трафик не пойдет обходным путем.

Когда клиенту необходимо получить ресурс от какого-либо сервера (файл, веб-страницу,
почтовое сообщение), он посылает свой запрос соответствующему прокси-серверу. Последний анализирует этот запрос и на
основании заданных ему администратором правил
решает, каким образом он должен быть обработан: отброшен, передан без изменения ресурсному серверу, модифицирован тем
или иным способом перед передачей, немедленно
обработан силами самого прокси-сервера и др.
В качестве правил, которыми руководствуется прокси-сервер, могут выступать условия пакетной фильтрации.

Помимо основных функций, многие прокси-серверы могут выполнять другие полезные
операции, например, _обнаруживать вирусы_ еще до того, как они попали во внутреннюю
сеть, или собирать _статистические данные_ о работе пользователей сети в Интернете. В некоторых случаях прокси-сервер
может изменять запрос клиента.

![Варианты размещения прокси-сервера](img/img_17.png)

Прокси-сервер веб-службы
может осуществлять административный контроль проходящего через него контента,
в частности, ограничивать доступ клиента к сайтам, имеющим IP-адреса или DNS-имена
из «черных списков». Более того, он может фильтровать сообщения на основе ключевых
слов. Различают прокси-серверы прикладного и сеансового уровней:

* `Прокси-сервер прикладного уровня`, как это следует из его названия, умеет «вклиниваться» в процедуру взаимодействия
  клиента и сервера по одному из прикладных
  протоколов, например HTTP, HTTPS, SMTP/POP, FTP или telnet. Чтобы выступать
  в роли посредника на прикладном уровне, прокси-сервер должен «понимать» смысл
  команд, «знать» форматы и последовательность сообщений, которыми обмениваются
  клиент и сервер соответствующей службы. Это позволяет прокси-серверу проводить
  анализ содержимого сообщений, делать заключения о подозрительном характере того
  или иного сеанса.
* `Прокси-сервер сеансового уровня` выполняет свою посредническую миссию на транспортном уровне, контролируя
  TCP-соединение. Очевидно, что, работая на более низком уровне, прокси-сервер обладает гораздо меньшим «интеллектом» и
  имеет меньше
  возможностей для выявления и предупреждения атак. Но он обладает и очень важным
  преимуществом перед прокси-сервером прикладного уровня — универсальностью, то
  есть он может быть использован любыми приложениями, работающими по протоколу TCP (а в некоторых случаях и UDP).

## Фаервол, основные функции, классификация

## Фаервол - схема настройки и фильтрации пакетов

## Определение и принципы работы WAF, NGFW, UTM

## Структура правила snort

## Атака TCP syn flood

## Атака TCP syn-ACK flood

## Атаки TCP rst\FIN flood

## Атака фраментированный ICMP\UDP flood, атака Ping Of Death

## Атака ARP-spoo FINg

